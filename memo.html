<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>VsCode&#x3067;XAMAPP&#x3092;&#x30c7;&#x30d0;&#x30c3;&#x30b0;&#x3059;&#x308b;&#x8a2d;&#x5b9a;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <link href="memo.css" rel="stylesheet"></link>
※ MarkDownのプレビューは VSCodeで [Ctrl]-[Shift]-[V] を押す
<style>
table th {
  background-color: #b0b0e0; /* ヘッダの背景色 */
  color: #40b371;/*文字色*/
}
table tr:nth-child(odd) {
  background-color: #e0e0e0; /* 奇数行の背景色 */
}
table tr:nth-child(even) {
  background-color: #cec0c0; /* 偶数行の背景色 */
}
h2 {
  background-color: #e0e0e0; /* 奇数行の背景色 */
  border-top: 4px solid;
  color: magenta;
}
h2::before {
	content: "★";
}
</style>
<p>環境変数の確認</p>
<blockquote>
<p>&gt;rundll32.exe sysdm.cpl,EditEnvironmentVariables</p>
</blockquote>
<p>ルート設定の一覧表示</p>
<blockquote>
<p>&gt;php artisan route:list</p>
</blockquote>
<h2 id="vscodeでxamappをデバッグする設定">VsCodeでXAMAPPをデバッグする設定</h2>
<ul>
<Li type="1"> ブラウザでphpinfo()を表示して全てコピー(CTRL-A)</li>
<Li type="1"> https://xdebug.org/wizard を開き、textAreaにペースト(CTRL-P)後 [phpinfo()の出力を分析する]をクリック</li>
<Li type="1"> php_xdebug-XXX.dllのリンクが現れるのでダウンロードして xamp\php\ext にコピー</li>
<Li type="1"> xamp\php\php.iniを開き、以下を追加  </li>
</ul>
<pre><code>[XDebug]  
xdebug.remote_enable=1  
xdebug.remote_autostart=1  
;以下はサイトに記載されてたもの  
zend_extension = D:\xampp\php\ext\php_xdebug-XXX.dll  
</code></pre>
<p>◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆</p>
<h2 id="laravelプロジェクト新規作成">Laravelプロジェクト新規作成</h2>
<h4 id="yoyaku-プロジェクトを作成">yoyaku プロジェクトを作成</h4>
<blockquote>
<p>composer create-project laravel/laravel yoyaku --prefer-dist</p>
</blockquote>
<h4 id="laravelcollective-パッケージのインストール">laravelcollective パッケージのインストール</h4>
<blockquote>
<p>composer require laravelcollective/html</p>
</blockquote>
<h4 id="laravelcollective-の削除">laravelcollective の削除</h4>
<blockquote>
<p>composer remove laravelcollective/html</p>
</blockquote>
<h4 id="spatielaravel-html-パッケージののインストール">spatie/laravel-html パッケージののインストール</h4>
<p>◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆</p>
<h4 id="ｄｂの接続設定">ＤＢの接続設定</h4>
<li>.env  の以下を変更</li>
<pre><code>DB_CONNECTION=mysql
DB_HOST=127.0.0.1　　　　　　　　　　　← ローカルデバッグ用
#DB_HOST=mysql303.phy.lolipop.lan　　← Loripop 用. アップロード時に変更
DB_DATABASE=LAA1590428-kyum
DB_USERNAME=LAA1590428
DB_PASSWORD=k1lt7Ovl 
</code></pre>
<h4 id="言語設定">言語設定</h4>
<li>app.php の以下を変更</li>
<pre><code>'timezone' =&gt; 'Asia/Tokyo',
'local' =&gt; 'ja',
'faker_local' =&gt; 'ja_JP',
</code></pre>
<li>日本語化翻訳ファイルを作成</li>
<blockquote>
<p>php artisan lang:publish</p>
</blockquote>
<p>実行すると、プロジェクトフォルダ直下に\lang\フォルダが作成させる</p>
<p>Laravel Breeze日本語化パッケージ（Breezeとは 認証画面の機能)
<a href="https://github.com/askdkc/breezejp">https://github.com/askdkc/breezejp</a></p>
<p>php.ini の以下のコメントを外す
extension=zip</p>
<p>組み込みコマンド</p>
<blockquote>
<p>&gt;composer require askdkc/breezejp --dev
&gt;php artisan breezejp</p>
</blockquote>
<p>これにより、\lang\フォルダに\ja\が作成され、日本語メッセージが定義されたファイルが作成される</p>
<p>◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆</p>
<h2 id="コマンドラインcliから-mysql-に接続する">コマンドライン(CLI)から MySQL に接続する</h2>
<pre><code>&gt;C:\XAMPP\MySQL\BIN\mysql -u LAA1590428 -p -h localhost ` LAA1590428-kyum 
password : k1lt7Ovl
</code></pre>
<h2 id="larabelからmysqlへの接続設定">LarabelからMySQLへの接続設定</h2>
<blockquote>
<p>create table users(id int,title varchar(10));</p>
</blockquote>
<p>◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆</p>
<h2 id="larabelページへのアクセス">Larabelページへのアクセス</h2>
<p><a href="http://localhost/yoyaku/public/">http://localhost/yoyaku/public/</a></p>
<p>routes\web.php</p>
<pre><code>Route::get('/', function () {
    return view('welcome');
});
</code></pre>
<p>ルートが呼ばれると
resources\views\welcome.blade.php
画面が開く</p>
<p>◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆</p>
<h2 id="認証画面としてbreezeを追加">認証画面としてBreezeを追加</h2>
<p>breezeを使用するには composer を使用する
composerとはlaravelにおいて使用可能な便利なフレームワークやライブラリを管理するシステムです。
composerがあることで、例えばAというライブラリをダウンロードする際に他に必要なライブラリも自動的にダウンロードしてくれる</p>
<h4 id="以下のコマンドを入力すると認証画面が追加される">以下のコマンドを入力すると認証画面が追加される</h4>
<blockquote>
<p>&gt;composer require laravel/breeze</p>
</blockquote>
<p>実行するとcomposer.jsonファイルにBreezeのバージョン情報が入る</p>
<pre><code>    &quot;require&quot;: {
        &quot;php&quot;: &quot;^8.1&quot;,
        &quot;guzzlehttp/guzzle&quot;: &quot;^7.2&quot;,
        &quot;laravel/breeze&quot;: &quot;^1.29&quot;,			←─── Breezeが入る
        &quot;laravel/framework&quot;: &quot;^10.10&quot;,
        &quot;laravel/sanctum&quot;: &quot;^3.3&quot;,
        &quot;laravel/tinker&quot;: &quot;^2.8&quot;
    },
</code></pre>
<h4 id="プロジェクトへの組み込み">プロジェクトへの組み込み</h4>
<blockquote>
<p>php artisan breeze:install blade</p>
</blockquote>
<p>app\Http\Controllers\Authフォルダ内に幾つかのソースが追加され、ブラウザで開くと画面左上にメニュー「login (ログイン)」と「Resister (登録)」が追加されている</p>
<h4 id="テーブルの定義を追加">テーブルの定義を追加</h4>
<blockquote>
<p>&gt; php artisan make:migration create_XXXX_table</p>
</blockquote>
<p>実行すると以下のPHPファイルが作成＆追加される
yoyaku\database\migrations\2019_12_14_000001_create_XXXX_table.php</p>
<table><tr><td>
参考：データベースのログイン処理は以下に定義されている
yoyaku\vendor\laravel\framework\src\Illuminate\Database\Connectors\Connector.php
<pre><code>&lt;?php
　　　　　：
class Connector
{
    use DetectsLostConnections;
　　　　　：
</code></pre>
<td></tr></table>
<h2 id="フォームの追加">フォームの追加</h2>
<h4 id="laravelフォームを追加するには-最低限以下-を作成する">Laravelフォームを追加するには 最低限以下 を作成する</h4>
<table border=2>
<tr><th>モデル           </th><td>\app\Models\ *.php </td><td>
                                    Eloquent（DBのデータを操作する実装）の機能とビジネスロジックを持つ</td></tr>
<tr><th>マイグレーション </th><td>\database\migrations\ * .php </th><td>
                                    データベース定義</td></tr>
<tr><th>ビュー           </th><td>\resources\views\post\ *.blade.php</th><td>
                                    GUIフォームを定義</td></tr>
<tr><th>コントローラー   </th><td>\app\Http\Controllers\ *Controller.php</th><td>
                                    web.phpから呼ばれる関数を定義し、対象となるviewファイルを返す</td></tr>
<tr><th>ルート設定を追加 </th><td>\routes\web.php</th><td>
                                    ブラウザからの入口でルートを定義。
                                    methodとパスにより使用するコントローラーを定義する</td></tr>
</table>
<h4 id="モデルファイルの新規作成">モデル(ファイル)の新規作成</li></h4>
<p>モデルファイルを作成時に、関連するファイルも生成する場合は、以下の [option]指定を行う</p>
<blockquote>
<p>&gt;php artisan make:model モデル名 [option]</p>
</blockquote>
<table border=1>
<tr><th>option            </th><th> モデル</th><th>マイグ<br>レーション</th><th>コントローラ</th><th>シーダ </th><th>ファクトリ</th><th>フォーム<br>リクエスト</th><th>ポリシー</th></tr>
<tr><td>--all , -a        </td><td>●      </td><td>●                  </td><td>●          </td><td>●      </td><td>●         </td><td>●                    </td><td>●</td></tr>
<tr><td>--controller , -c </td><td>●      </td><td>-                  </td><td>●          </td><td>-      </td><td>-         </td><td>-                    </td><td>-</td></tr>
<tr><td>--factory , -f    </td><td>●      </td><td>-                  </td><td>-          </td><td>-      </td><td>●         </td><td>-                    </td><td>-</td></tr>
<tr><td>--force<br>上書き </td><td>●      </td><td>-                  </td><td>-          </td><td>-      </td><td>-         </td><td>-                    </td><td>-</td></tr>
<tr><td>--migration , -m  </td><td>●      </td><td>●                  </td><td>-          </td><td>-      </td><td>-         </td><td>-                    </td><td>-</td></tr>
<tr><td>--policy          </td><td>●      </td><td>-                  </td><td>-          </td><td>-      </td><td>-         </td><td>-                    </td><td>●</td></tr>
<tr><td>--seed  , -s      </td><td>●      </td><td>-                  </td><td>-          </td><td>●      </td><td>-         </td><td>-                    </td><td>-</td></tr>
<tr><td>--pivot , -p      </td><td>●      </td><td>-                  </td><td>-          </td><td>-      </td><td>-         </td><td>-                    </td><td>-</td></tr>
<tr><td>--resource ,-r    </td><td>●      </td><td>-                  </td><td>●          </td><td>-      </td><td>-         </td><td>-                    </td><td>-</td></tr>
<tr><td>--api             </td><td>-      </td><td>-                  </td><td>-          </td><td>-      </td><td>-         </td><td>-                    </td><td>-</td></tr>
<tr><td>--requests, -R    </td><td>●      </td><td>-                  </td><td>●          </td><td>-      </td><td>-         </td><td>● Store<br>Update    </td><td>-</td></tr>
<tr><td>--test            </td><td>-      </td><td>-                  </td><td>-          </td><td>-      </td><td>-         </td><td>-                    </td><td>-</td></tr>
</table>
<h4 id="eloquentの規定">Eloquentの規定</h4>
<h6 id="テーブル名">テーブル名</h6>
<p>クラスの複数形の「スネークケース」をテーブル名として使用します。したがって、この場合、EloquentはFlightモデルがflightsテーブルにレコードを格納し、AirTrafficControllerモデルはair_traffic_controllersテーブルにレコードを格納すると想定できます。
モデルの対応するデータベーステーブルがこの規約に適合しない場合は、モデルにtableプロパティを定義してモデルのテーブル名を自分で指定できます。</p>
<pre><code class="language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flight</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span>
</span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$table</span> = <span class="hljs-string">&#x27;my_flights&#x27;</span>;    <span class="hljs-comment">//  モデルに関連付けるテーブル</span>
}
</code></pre>
<h6 id="主キー">主キー</h6>
<p>各モデルの対応するデータベーステーブルにidという名前の主キーカラムがあることも想定している。
主キーを変更する場合は、モデルのprotected $primaryKeyプロパティを定義する。</p>
<pre><code class="language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flight</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span>
</span>{
    <span class="hljs-comment">// テーブルに関連付ける主キー</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$primaryKey</span> = <span class="hljs-string">&#x27;flight_id&#x27;</span>;
}
</code></pre>
<p>主キーは増分整数値であることも想定しています。これは、Eloquentが主キーを自動的に整数にキャストすることを意味します。非インクリメントまたは非数値の主キーを使用する場合は、モデルにpublicの$incrementingプロパティを定義し、falseをセットする必要があります。</p>
<p>主キーが整数でない場合は、モデルにprotectedな$keyTypeプロパティを定義する必要があります。このプロパティの値はstringにする必要があります。</p>
<pre><code class="language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flight</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$incrementing</span> = <span class="hljs-literal">false</span>;   <span class="hljs-comment">//  自動インクリメント無し</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$keyType</span> = <span class="hljs-string">&#x27;string&#x27;</span>;  <span class="hljs-comment">//  主キーは文字列</span>
}
</code></pre>
<h5 id="主キータイムスタンプ">主キータイムスタンプ</h5>
<p>モデルと対応するデータベーステーブルに、created_atカラムとupdated_atカラムが存在していると想定します。Eloquentはモデルが作成または更新されるときに、これらの列の値を自動的にセットします。これらのカラムがEloquentによって自動的に管理されないようにする場合は、モデルに$timestampsプロパティを定義し、false値をセットします。
タイムスタンプの保存に使用するカラム名をカスタマイズする必要がある場合は、モデルにCREATED_ATおよびUPDATED_AT定数を定義</p>
<pre><code class="language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flight</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$timestamps</span> = <span class="hljs-literal">false</span>;     <span class="hljs-comment">// モデルにタイムスタンプを付けるか</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$dateFormat</span> = <span class="hljs-string">&#x27;U&#x27;</span>;     <span class="hljs-comment">// モデルの日付カラムの保存用フォーマット</span>

    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CREATED_AT</span> = <span class="hljs-string">&#x27;creation_date&#x27;</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">UPDATED_AT</span> = <span class="hljs-string">&#x27;updated_date&#x27;</span>;
}
</code></pre>
<h6 id="デフォルト属性値">デフォルト属性値</h6>
<pre><code class="language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flight</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span>
</span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$attributes</span> = [
        <span class="hljs-string">&#x27;delayed&#x27;</span> =&gt; <span class="hljs-literal">false</span>,
    ];
}
</code></pre>
<h6 id="データベースにデータを登録または更新したい場合はfillableまたはguardedを記載する">データベースにデータを登録または更新したい場合は、fillableまたはguardedを記載する。</h6>
<li> $fillableはホワイトリスト方式としてデータ登録、更新を許可するカラムを指定します。</li>
<pre><code class="language-php">    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$fillable</span> = [
            <span class="hljs-string">&#x27;OrderNo&#x27;</span>,      <span class="hljs-comment">//  予約番号&#x27;);</span>
            <span class="hljs-string">&#x27;KeyStr&#x27;</span>,       <span class="hljs-comment">//  照会時に比較する&#x27;);	</span>
                :
    ];
</code></pre>
<li>$guardedはブラックリスト方式としてデータ登録、更新を許可しないカラムを指定。指定したカラム以外は許可される。</li>
<li>$castsでカラムに対しての型を定義する</li>
モデルで型を定義しておけば、データ取得時に指定した型で取得できる。
<pre><code class="language-php"><span class="hljs-keyword">protected</span> <span class="hljs-variable">$casts</span> = [
    <span class="hljs-string">&#x27;name&#x27;</span> =&gt; <span class="hljs-string">&#x27;string&#x27;</span>,
    <span class="hljs-string">&#x27;price&#x27;</span> =&gt; <span class="hljs-string">&#x27;integer&#x27;</span>,
    <span class="hljs-string">&#x27;flag&#x27;</span> =&gt; <span class="hljs-string">&#x27;boolean&#x27;</span>
];
</code></pre>
<p>cast指定の種類</p>
<table border=1>
<tr><th>型名</th>           <th> 機能</th></tr>
<tr><td>Integer</td>        <td>数字へ変換</td></tr>
<tr><td>float(real, double)</td><td>小数点つきの数字に変換</td></tr>
<tr><td>String</td>         <td>文字列化</td></tr>
<tr><td>boolean</td>        <td>trueもしくは、falseに変換<br>　true　・・・　1, 2, -1<br>　
false　・・・　0, 文字列の空白</td></tr>
<tr><td>object</td>         <td>PHPの「stdClass」に変換される<br>
            'colors' => ['red' => '赤', 'blue' => '青', 'yellow' => '黄色'    ]<br>
    のように定義すると json化されてデータベースに格納される
    </td></tr>
<tr><td>array</td>          <td>配列</td></tr>
<tr><td>collection</td>     <td></td></tr>
<tr><td>date, datetime</td> <td></td></tr>
<tr><td>timestamp</td>      <td></td></tr>
<tr><td>encrypted</td>      <td>暗号化</td></tr>
</table>
<li>リレーションを定義する</li>
<table border=1>
<tr><th>メソッド</th><th> 機能</th></tr>
<tr><td>hasOne</td><td>1対1：親テーブルから見た子テーブルのリレーション定義</td></tr>
<tr><td>belongsTo</td><td>1対1：子テーブルから見た親テーブルのリレーション定義</td></tr>
<tr><td>hasMany</td><td>1対多：親テーブルから見た子テーブルのリレーション定義</td></tr>
<tr><td>belongsToMany</td><td>1対多：子テーブルから親テーブルのリレーションを定義</td></tr>
</table>
<h4 id="テーブルの新規作成">テーブルの新規作成</h4>
<p>マイグレーションファイルの新規作成</p>
<blockquote>
<p>&gt;php artisan make:migration マイグレーションファイル名 [option]</p>
</blockquote>
<table border=1>
<tr><th>option         </th><th> 機能</th></tr>
<tr><td>無し </td><td>空のmigration phpを生成
具体的には空の up() / down() 関数が作られる
<pre><code class="language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">up</span>(<span class="hljs-params"></span>): <span class="hljs-title">void</span> </span>{
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">down</span>(<span class="hljs-params"></span>): <span class="hljs-title">void</span> </span>{
    }
</code></pre>
<tr><td>--create=tests </td><td>「tests」というテーブルを作成するphpを生成
具体的には up() / down() 関数に以下の定義が入る
<pre><code class="language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">up</span>(<span class="hljs-params"></span>): <span class="hljs-title">void</span> </span>{
        <span class="hljs-title class_">Schema</span>::<span class="hljs-title function_ invoke__">create</span>(<span class="hljs-string">&#x27;tests&#x27;</span>, function (Blueprint <span class="hljs-variable">$table</span>) {
            <span class="hljs-variable">$table</span>-&gt;<span class="hljs-title function_ invoke__">id</span>();
            <span class="hljs-variable">$table</span>-&gt;<span class="hljs-title function_ invoke__">timestamps</span>();
        });
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">down</span>(<span class="hljs-params"></span>): <span class="hljs-title">void</span> </span>{
        <span class="hljs-title class_">Schema</span>::<span class="hljs-title function_ invoke__">dropIfExists</span>(<span class="hljs-string">&#x27;tests&#x27;</span>);
    }
</code></pre>
</td><td></td></tr>
<tr><td>--table=tests  </td><td>「tests」というテーブルの構造を変更するphpを生成
具体的には up() / down() 関数に以下の定義が入る
<pre><code class="language-php">        <span class="hljs-title class_">Schema</span>::<span class="hljs-title function_ invoke__">table</span>(<span class="hljs-string">&#x27;tests&#x27;</span>, function (Blueprint <span class="hljs-variable">$table</span>) {
            <span class="hljs-comment">//</span>
        });
</code></pre>
</td><td></td></tr>
</table>
<p>migrate: xxx コマンド</p>
<table border=1>
<tr><td>php artisan migrate:status              </td><td> マイグレーションの状態確認</td></tr>
<tr><td>php artisan migrate [--path=<i>migratonファイル名</i>]</td><td> マイグレーション実行<br>
                                                            composer dump-autoload「クラスが見つかりません」エラーが発生したら、migrateコマンドを再発行してみる</td></tr>
<tr><td>php artisan migrate:refresh             </td><td> 初期化→再実行（マイグレーションファイル追加でエラーが出た時など）<br>
--path=/database/migrations/XXXX_table</td></tr>
<tr><td>php artisan migrate:fresh               </td><td> 全テーブル削除 →マイグレーション実行</td></tr>
<tr><td>php artisan migrate:rollback            </td><td> 直前のマイグレーションをロールバック</td></tr>
<tr><td>php artisan migrate:rollback [--step=n]   </td><td> ロールバック（戻る位置指定）</td></tr>
<tr><td>php artisan migrate:reset               </td><td> 全マイグレーションをリセット（初期化）<br>
ファイル指定の場合は以下オプションを追加<br>
<b> --path=database\migrations\"ファイル名"_table.php</b></td></tr>
</table>
<h2 id="テーブル構造の変更">テーブル構造の変更</h2>
<blockquote>
<p>&gt;php artisan make:migration add_test_column --table=users</p>
</blockquote>
<pre><code class="language-php">   INFO  Migration [C:\Tools\AnHttpd\nmaki\yoyaku\database\migrations/<span class="hljs-number">2024_08_03_100631</span>_add_test_column.php] created successfully.
</code></pre>
<p>上記コマンドにより、yyyy_mm_dd_hhmmss_add_test_column.php ファイルが作成される</p>
<p>database\migrations\2024_08_03_100631_add_test_column.php</p>
<pre><code>return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {   //  'test'カラムを追加する処理
        Schema::table('users', function (Blueprint $table) {
            $table-&gt;increments('id');                //  自動加算のID
            $table-&gt;string('email')-&gt;after('id');    //  追加するカラム情報 Text型
            $table-&gt;dateTime('enterDate')            //  日付け型
            $table-&gt;integer('kaisu')-&gt;comment('回数');

            $table-&gt;rememberToken();        //  トークン(パスワードリセット用)
            $table-&gt;timestamps();           //  タイムスタンプ(updated_atとcreated_at)
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {   //  'test'カラムを削除する処理
        Schema::table('users', function (Blueprint $table) {
            //削除するカラム情報
            $table-&gt;dropColumn('test');
        });
    }
};
</code></pre>
<table>
<thead>
<tr><th>メソッド</th><th>データ型</th><th>説明</th></tr>
</thead>
<tbody>
<tr><td>string</td><td>VARCHAR</td><td>可変長の文字列　255文字まで</td></tr>
<tr><td>char('カラム名', 長さ)</td><td></td><td>	長さ指定の文字型</td></tr>
<tr><td>double('カラム名', 合計桁数, 小数桁数)</td><td></td><td>浮動小数点型</td></tr>
<tr><td>enum('カラム名', ['定数', '定数'])</td><td></td><td>$table->enum('status', ['Draft', 'Published', 'Archived']);</td></tr>
<tr><td>json('カラム名')</td><td></td><td>JSON型	</td></tr>
<tr><td>binary('カラム名')</td><td></td><td>バイナリデータ型</td></tr>
<tr><td>text</td><td>TEXT</td><td>大きなテキストデータを格納する　16384文字まで</td></tr>
<tr><td>longText</td><td>TEXT</td><td>大きなテキストデータを格納する　１GB</td></tr>
<tr><td>increments</td><td>符号なしINT</td><td>1から始まり、次のレコードは2、3と自動的に増加する整数。自動的に主キーとして設定されます</td></tr>
<tr><td>integer</td><td>int</td><td>整数</td></tr>
<tr><td>boolean</td><td>真偽値</td><td>真偽値（trueまたはfalse）</td></tr>
<tr><td>char</td><td>文字列</td><td>指定した長さの文字列を格納するカラム</td></tr>
<tr><td>date</td><td>date</td><td>日付</td></tr>
<tr><td>dateTime</td><td>dateTime</td><td>日付と時間が「YYYY-MM-DD HH:MM:SS」の形式で年、月、日、時、分、秒の情報が含まれています。</td></tr>
<tr><td>timestamp</td><td>timestamp</td><td>現在の日時</td></tr>
<tr><td>timestamps</td><td>timestamps</td><td>作成日(created_at)と更新日(updated_at)を作成する</td></tr>
</tbody>
</table>
<p>データベースカラムに制約を追加するためのメソッド</h1></p>
<table>
<thead>
<tr><th>メソッド</th><th>使用例</th><th>説明</th></tr>
</thead>
<tbody>
<tr><td>first</td><td><code>string('name')-&gt;first()</code></td><td>指定したカラムのテーブルの最初のカラムに設定する</td></tr>
<tr><td>after</td><td><code>string('name')-&gt;after('email')</code></td><td>指定したカラムの次にカラムを追加する</td></tr>
<tr><td>unique</td><td><code>string('email')-&gt;unique()</code></td><td>同じ値がデータベーステーブルの指定したカラムに重複して保存されることを防ぐ</td></tr>
<tr><td>change</td><td><code>string('email')-&gt;nullable()-&gt;change()</code></td><td>カラムの属性を変更する</td></tr>
<tr><td>comment</td><td><code>text('content')-&gt;comment('blog')</code></td><td>カラムにコメント追加する</td></tr>
<tr><td>default</td><td><code>string('status')-&gt;default('active')</code></td><td>カラムのデフォルト値を設定する</td></tr>
<tr><td>nullable</td><td><code>string('email')-&gt;nullable()</code></td><td>NULL値をデフォルトでカラムに挿入する</td></tr>
<tr><td>nullable</td><td><code>string('email')-&gt;nullable(false)</code></td><td>NULL値を許容しない</td></tr>
</tbody>
</table>
<h2 id="migrateコマンドでカラムを追加する">migrateコマンドでカラムを追加する</h2>
<blockquote>
<p>/&gt; php artisan migrate</p>
</blockquote>
<pre><code class="language-php">   INFO  Running migrations.

  <span class="hljs-number">2024_08_03_100631</span>_add_test_column .................................................................... <span class="hljs-number">28</span>ms DONE
</code></pre>
<p>add_test_column.phpのup()関数が呼ばれて、'test'カラムが追加される</p>
<p>migrateで全てのmigrateを削除するには以下のコマンドを入力</p>
<blockquote>
<p>&gt; php artisan migrate:reset</p>
</blockquote>
<pre><code class="language-php">   INFO  Rolling back migrations.

  <span class="hljs-number">2024_08_03_100631</span>_add_test_column ..................................................................... <span class="hljs-number">2</span>ms DONE
  <span class="hljs-number">2019_12_14_000001</span>_create_personal_access_tokens_table ................................................ <span class="hljs-number">20</span>ms DONE
  <span class="hljs-number">2019_08_19_000000</span>_create_failed_jobs_table ........................................................... <span class="hljs-number">14</span>ms DONE
  <span class="hljs-number">2014_10_12_100000</span>_create_password_reset_tokens_table ................................................. <span class="hljs-number">15</span>ms DONE
  <span class="hljs-number">2014_10_12_000000</span>_create_users_table ................................................................. <span class="hljs-number">14</span>ms DONE
</code></pre>
<p>特定のテーブルのみmigrate</p>
<blockquote>
<p>&gt;php artisan migrate:refresh --path=/database/migrations/2021_08_28_061818_create_boards_table.php</p>
</blockquote>
</ul>
<p>◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆</p>
<h2 id="コントローラーの作成">コントローラーの作成</h2>
<ul>
<li type="1"> コマンド</li>
<blockquote>
<p>&gt;php artisan make:conroller TestController</p>
</blockquote>
<p>ソース yoyaku\app\Http\Controllers\TestController.php が作成される</p>
<li type="1"> 関数実装</li>
TestController.phpの class本体に test() 関数を追加する
　：
<pre><code class="language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-comment">// routes\web.php から呼ばれる</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">view</span>(<span class="hljs-string">&quot;test&quot;</span>); ←yoyaku\resources\views\test.blade.phpを表示せよ
    }
}
</code></pre>
<li type="1"> 表示内容を定義</li>
<p>yoyaku\resources\views\test.blade.phpに表示内容を定義する</p>
<pre><code>    こんにちわ
</code></pre>
<li type="1"> 使用宣言</li>
生成されたControllerを使用するため routes\web.php に use 宣言を追加
<pre><code class="language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>\<span class="hljs-title">TestController</span>;
</code></pre>
<li type="1"> 使用</li>
routes\web.php に呼び出しを追加
<p>Route::get('/ルート定義', 宣言方法 [ファイル/クラス名::class, '関数名'])</p>
<pre><code class="language-php"><span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;/test&#x27;</span>, [<span class="hljs-title class_">TestController</span>::<span class="hljs-variable language_">class</span>, <span class="hljs-string">&#x27;test&#x27;</span>]) 
    -&gt;<span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&#x27;test&#x27;</span>);
</code></pre>
</ul>
<p>■まとめ■
<a href="http://127.0.0.1/yoyaku/public/test">http://127.0.0.1/yoyaku/public/test</a> で任意のページを表示させるには
Controllerを作成 → viewに表示内容を定義 → routes\web.phpで引数を定義</p>
<h2 id="view操作">View操作</h2>
<table>
<tr><th >　　　ディレクティブ　　　</th>
<th>　　　　　　　役割 　　　　　　　</th></tr>
<tr><td>@php ～ @endphp</td><td>php 処理</td></tr>
<tr><td>@if(条件)～ @endif</td><td>条件分岐</td></tr>
<tr><td>@switch</label>(評価値)<br>
                        　@case(条件値)<br>
                        　@default(条件値)<br>
                        @endswitch</td>
                        <td>条件分岐</td></tr>
<tr><td >@unless (変数)</td><td >条件非成立の時表示</td></tr>
<tr><td >@empty  (変数)～@endempty</td><td >変数が空の場合表示</td></tr>
<tr><td >@isset  (変数)～@endisset</td><td >変数が定義済みの場合表示</td></tr>
<tr><td >@for    (初期化 ; 条件; 後処理;)～@endfor</td><td >PHPのfor構文に相当するもの</td></tr>
<tr><td >@foreach    ($配列 as $変数)</td><td >PHPのforeach構文に相当するもの</td></tr>
<tr><td >@forelse ($配列 as $変数)<br>@empty</td><td >PHPのforeachに加え、@emptyで空だったときの処理が記述できる</td></tr>
<tr><td >@while  (条件)～@endwhile</td><td >PHPのwhile構文に相当するもの</td></tr>
<tr><td >@section   (名前)</strong></td><td >指定した名前でセクションが用意される</td></tr>
<tr><td >@parent    </td><td >親レイアウトのセクションを示す</td></tr>
<tr><td >@yield (名前)</strong></td><td >配置場所を示すもの</td></tr>
<tr><td >@extends    (Bladeのファイル名)</td><td >レイアウトの継承設定</td></tr>
<tr><td >@component  (名前)</td><td >コンポーネントの組み込み</td></tr>
<tr><td >@slot   (名前)</td><td >{{}}で指定された変数に値を設定する</td></tr>
<tr><td >@include    (読み込むテンプレート名,[値の指定])</td><td >サブビューの読み込み</td></tr>
<tr><td >@each   (テンプレート名, 配列, 配列から取り出したデータを入れる変数名)</td><td >配列などから値を取り出し指定のテンプレートにはめ込んで出力する</td></tr>
</table>
<pre><code class="language-php">@<span class="hljs-keyword">isset</span> (<span class="hljs-variable">$value</span>)
    <span class="hljs-comment">// $value が定義済みの場合表示する</span>
    @<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$users</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$user</span>)
        &lt;li&gt;{{ <span class="hljs-variable">$user</span>-&gt;name }}&lt;/li&gt;
        @<span class="hljs-keyword">if</span> (<span class="hljs-variable">$user</span>-&gt;id == <span class="hljs-number">5</span>)
        <span class="hljs-comment">// ループ終了</span>
            @<span class="hljs-keyword">break</span>
        @<span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$value02</span>)
        <span class="hljs-comment">// 違う条件の場合で true だった場合の表示</span>
        @<span class="hljs-keyword">else</span>
        @<span class="hljs-keyword">endif</span>

        <span class="hljs-comment">// @loopが暗黙で定義され、回数が取得できる  </span>
        @<span class="hljs-keyword">if</span> (<span class="hljs-variable">$loop</span>-&gt;first)              <span class="hljs-comment">// 最初の繰り返し</span>
        @<span class="hljs-keyword">if</span> (<span class="hljs-variable">$loop</span>-&gt;index === <span class="hljs-number">0</span>)        <span class="hljs-comment">// 最初の繰り返し(インデックスが取れる)</span>
        @<span class="hljs-keyword">if</span> (<span class="hljs-variable">$loop</span>-&gt;iteration === <span class="hljs-number">1</span>)    <span class="hljs-comment">// 最初の繰り返し(現在の繰り返し数が取れる)</span>
        @<span class="hljs-keyword">if</span> (<span class="hljs-variable">$loop</span>-&gt;last)               <span class="hljs-comment">// 最後の繰り返し</span>
        @<span class="hljs-keyword">if</span> (<span class="hljs-variable">$loop</span>-&gt;remaining === <span class="hljs-number">1</span>)    <span class="hljs-comment">// 最後の繰り返し (残りの繰り返し数が取れる)</span>

    @<span class="hljs-keyword">endforeach</span>

@endisset

@auth
    @<span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">10</span>; <span class="hljs-variable">$i</span>++)
    <span class="hljs-comment">// 繰り返し処理</span>
    {{ <span class="hljs-variable">$i</span> }} {{ <span class="hljs-title class_">Auth</span>::<span class="hljs-title function_ invoke__">user</span>()-&gt;name }}さん、をつ!
    @<span class="hljs-keyword">endfor</span>
@endauth
</code></pre>
<h2 id="コンポーネントの利用">コンポーネントの利用</h2>
<ul>
<li> ボタン等を構成するファイルを以下に配置</li>
yoyaku\resources\views\components\
<p>yoyaku\resources\views\dashboard.blade.php</p>
<h2 id="テンプレート">テンプレート</h2>
<li> 通常テンプレートの配置</li>
yoyaku\resources\views\layouts\app.blade.php
<p>Viteとは webpack、Rollup、Parcelのようなビルドツールの1つ。
これらの役割としては、プロジェクトすべてのファイルをコンパイル・結合して一つの塊（バンドル）となったファイルを生成してくれます。</p>
<pre><code class="language-php">        &lt;!-- Scripts --&gt;
        @<span class="hljs-title function_ invoke__">vite</span>([<span class="hljs-string">&#x27;resources/css/app.css&#x27;</span>, <span class="hljs-string">&#x27;resources/js/app.js&#x27;</span>])
</code></pre>
<li> app.cssには TailWind CSS の利用宣言が入る</li>
<pre><code class="language-php">@tailwind base;
@tailwind components;
@tailwind utilities;
</code></pre>
<p>app.jsには Alpine.js  の利用宣言が入る</p>
<pre><code class="language-php">import <span class="hljs-string">&#x27;./bootstrap&#x27;</span>;
import Alpine <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;alpinejs&#x27;</span>;
window.Alpine = Alpine;
Alpine.<span class="hljs-title function_ invoke__">start</span>();
</code></pre>
<h2 id="スロット定義">スロット定義</h2>
<li>{{ $header }} と書くと下記のheader定義内が展開される</li>
<li>{{ $slot }}と書くと下記のslot定義内が展開される</li>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">x-app-layout</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x-slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;header&quot;</span>&gt;</span>
        header文字列
    <span class="hljs-tag">&lt;/<span class="hljs-name">xslot</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x-slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;slot&quot;</span>&gt;</span>
        slotの文字列
    <span class="hljs-tag">&lt;/<span class="hljs-name">xslot</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">x-app-layout</span>&gt;</span>
</code></pre>
</ul>
<h4 id="コントロールの定義方法">コントロールの定義方法</h4>
<p>スタイルは「Tailwind CSS」で記述することが推奨されている
Tailwind CSSは、ユーティリティクラスを使って効率的にスタイリングできるフレームワークです。</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;{{ $name }}&quot;</span>&gt;</span>{{ $slot }}<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
    <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;{{ $type }}&quot;</span> 
    <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;{{ $name }}&quot;</span> 
    <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;{{ $name }}&quot;</span> 
    <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;py-2 border border-gray-300 rounded-md&quot;</span>
    <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;{{ $value }}&quot;</span> 
    <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;{{ $placeholder }}&quot;</span> 
    {{ $<span class="hljs-attr">attributes</span> }}
/&gt;</span>
</code></pre>
<table border=2>
<tr>
<tr><td rowspan=3> レイアウト</td>  <td> container</td>         <td> 
コンテナ要素を作成し、中央寄せと幅の調整を自動で行う
<pre><code>&lt;div class=&quot;container mx-auto&quot;&gt;
    &lt;!-- コンテンツ --&gt;
&lt;/div&gt;
</code></pre>
</td></tr>
<tr>                                <td> flex </td>             <td> フレックスボックスのコンテナを作成</td></tr>
<tr>                                <td> grid </td>             <td> グリッドレイアウトのコンテナを作成</td></tr>
<tr><td rowspan=2> 幅・高さ</td>    <td>  w-full</td>           <td> </td></tr>
<tr>                                <td> h-screen </td>         <td> </td></tr>
<tr><td rowspan=2> 色</td>          <td> bg-blue-500</td>       <td> </td></tr>
<tr>                                <td> text-gray-800 </td>    <td> </td></tr>
<tr><td rowspan=2>余白</td>         <td>  p-4</td>              <td> </td></tr>
<tr>                                <td> m-4 など</td>          <td> </td></tr>
<tr><td rowspan=2>ボーダー</td>     <td>  border</td>           <td> </td></tr>
<tr>                                <td> border-gray-300 </td>  <td> </td></tr>
<tr><td rowspan=2>テキスト整形</td> <td> text-center</td>        <td> </td></tr>
<tr>                                <td> font-bold </td>        <td> </td></tr>
<tr><td rowspan=2>ホバー・レスポンシブ</td><td> hover:bg-blue-700</td> <td> </td></tr>
<tr>                                <td> md:text-lg </td><      <td> </td></tr>
</table>
<h2 id="ルートの定義方法">ルートの定義方法</h2>
<p>ルーティングとは、クライアントからのアクセスに対応してどういう処理をするか決めること。
例えば、「http://.../○○というアドレスにアクセスしたら、××コントローラの△△アクションを実行する」みたいな感じ</p>
<h4 id="ルーティングを指定するにはfunctionで処理内容を記述する方法とコントローラーを指定する方法がある">ルーティングを指定するには、function()で処理内容を記述する方法と、コントローラーを指定する方法がある</h4>
<li>function指定の書き方</li>
<pre><code class="language-php">　　　　①↓　　　　　　②↓　　　　　　
<span class="hljs-title class_">Route</span>::<span class="hljs-variable constant_">HTTP</span>メソッド(<span class="hljs-string">&#x27;URLパス&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-variable">$message</span></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">view</span>(<span class="hljs-string">&#x27;hello.index&#x27;</span>, [<span class="hljs-string">&#x27;msg&#x27;</span>=&gt;<span class="hljs-variable">$message</span>]);
});
</code></pre>
<li>コントローラ指定の書き方</li>
<pre><code class="language-php">　　　　①↓　　　　　②↓　　　　　　③↓　　　　　　　　　　　④↓　　　　　　　　　⑤↓
<span class="hljs-title class_">Route</span>::<span class="hljs-variable constant_">HTTP</span>メソッド(<span class="hljs-string">&#x27;URLパス&#x27;</span>, [コントローラー::<span class="hljs-variable language_">class</span>, <span class="hljs-string">&#x27;メソッド名&#x27;</span>])-&gt;<span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&#x27;ルート名&#x27;</span>);
</code></pre>
<h4 id="-httpメソッド動詞に対応して以下が使える">① HTTPメソッド(動詞)に対応して、以下が使える</h4>
<table border=1>
<tr><th >　　　ディレクティブ　　　</th><th >　　　　　　</th></tr>
<tr><td><li> Route::get</li></td><td>データを取得する基本的なもの</td></tr>
<tr><td><li> Route::post</li></td><td>データの追加に使用</td></tr>
<tr><td><li> Route::put</li></td><td>データの更新に使用</td></tr>
<tr><td><li> Route::patch</li></td><td>ほぼPUTと同じですが、ごく一部を更新</td></tr>
<tr><td><li> Route::delete</li> </td><td>データの削除に使用</td></tr>
<tr><td><li> Route::options</li> </td><td>使えるメソッド一覧を表示</td></tr>
</table>
<h4 id="function指定による記述例">function指定による記述例</h4>
<table border=1>
<tr><td>
<pre><code class="language-php"><span class="hljs-comment">// クロージャの中にpathに対応する処理を書く</span>
<span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, function() {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">view</span>(<span class="hljs-string">&#x27;welcome&#x27;</span>);  
});

<span class="hljs-comment">//「&#x27;/index/test&#x27;とアクセスされたら、&#x27;test&#x27;が$messageに代入されて、helloフォルダのテンプレート&#x27;index&#x27;をブラウザに表示する」ということになる。</span>
<span class="hljs-comment">// この時、テンプレート&#x27;index&#x27;内の$msgに$message(つまり&#x27;test&#x27;)が代入される。</span>
<span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;index/{msg}&#x27;</span>, function(<span class="hljs-variable">$message</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">view</span>(<span class="hljs-string">&#x27;hello.index&#x27;</span>, [<span class="hljs-string">&#x27;msg&#x27;</span>=&gt;<span class="hljs-variable">$message</span>]);
});

<span class="hljs-comment">// 省略可能なパラメータの場合はパラメータ名($msg) の後ろに ? を書く</span>
<span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;index/{msg?}&#x27;</span>, function(<span class="hljs-variable">$message</span>=<span class="hljs-string">&#x27;Hello&#x27;</span>) ・・・


<span class="hljs-comment">//idは$param1、nameは$param2に代入される</span>
<span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;index/{id}/{name}&#x27;</span>, function(<span class="hljs-variable">$param1</span>, <span class="hljs-variable">$param2</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">view</span>(<span class="hljs-string">&#x27;hello.index&#x27;</span>, [<span class="hljs-string">&#x27;id&#x27;</span>=&gt;<span class="hljs-variable">$param1</span>, <span class="hljs-string">&#x27;name&#x27;</span>=&gt;<span class="hljs-variable">$param2</span>]);
});
</code></pre>
</td></tr></table>
<h4 id="class指定による記述例">class指定による記述例</h4>
<li>⑤ ルートに名前(->name()) を付けると、ビューやコントローラーで名前を指定して使用できるようになる</li>
<table border=1>
<tr><td>
<pre><code class="language-php"><span class="hljs-comment">// 使用例</span>
<span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;/hello&#x27;</span>, [<span class="hljs-title class_">HelloController</span>::<span class="hljs-variable language_">class</span>, <span class="hljs-string">&#x27;index&#x27;</span>])-&gt;<span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&#x27;hello&#x27;</span>);
</code></pre>
<p>上記の neme 定義を行うと、コントローラやビューで以下の <b>route{}</b> 定義が使用できる</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{{ route(&#x27;hello&#x27;) }}&gt;リンク名&lt;/a&gt;
// 引数がある場合
&lt;a href=&quot;</span>{{ <span class="hljs-attr">route</span>(&#x27;<span class="hljs-attr">hello</span>&#x27;,[&#x27;<span class="hljs-attr">id</span>&#x27; =&gt;</span> 1]) }}&quot;&gt;テスト<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
</td></tr></table>
<li>パラメータを指定する方法</li>
<table border=1>
<tr><td>
<pre><code class="language-php"><span class="hljs-comment">// URLにパラメータ埋め込み</span>
<span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;path/{parameter}&#x27;</span>, [コントローラークラス名::<span class="hljs-variable language_">class</span>, <span class="hljs-string">&#x27;メソッド名&#x27;</span>]);
<span class="hljs-comment">// 使用例</span>
<span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;/users/{id}&#x27;</span>, [<span class="hljs-title class_">UserController</span>::<span class="hljs-variable language_">class</span>, <span class="hljs-string">&#x27;show&#x27;</span>]);
<span class="hljs-comment">//  複数パラメータ指定</span>
<span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;/users/{id}/name/{name}&#x27;</span>, [<span class="hljs-title class_">UserController</span>::<span class="hljs-variable language_">class</span>, <span class="hljs-string">&#x27;show&#x27;</span>]);
</code></pre>
<p>XXXcontroller.php には以下を指定することになる</p>
<pre><code class="language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>) </span>{ }
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"><span class="hljs-variable">$id</span>,<span class="hljs-variable">$name</span></span>) </span>{ }
</code></pre>
</td></tr></table>
<h4 id="laravelのルーティングファイルにはwebphpとapiphpの2種類がある">Laravelのルーティングファイルには、web.phpとapi.phpの2種類がある</h4>
<h6 id="webphp">web.php</h6>
<p>通常、ブラウザからHTTPリクエストをうけて、画面に表示するようなルーティングを設定する場合に使用する。
CSRF保護などの機能が有効になっているため外部からのPOSTができない。</p>
<h6 id="apiphp">api.php</h6>
<p>外部からのHTTPリクエストをうけて、値を返却したりするようなルーティング(エンドポイント)を設定する場合に使用する。
CSRF保護が有効になっていないため外部からPOSTができる。</p>
<h2 id="フォームの作成">フォームの作成</h2>
<p>フォームを追加するには <b>モデル</b>・<b>ビュー</b>と<b>コントローラーファイル</b>を作成する</p>
<h4 id="モデルの作成">モデルの作成</h4>
<blockquote>
<p>&gt;php artisan make:model Post -m</p>
</blockquote>
<p>モデルファイル
database\migrations\2024_08_05_174658_create_posts_table.php</p>
<pre><code class="language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">up</span>(<span class="hljs-params"></span>): <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-title class_">Schema</span>::<span class="hljs-title function_ invoke__">create</span>(<span class="hljs-string">&#x27;posts&#x27;</span>, function (Blueprint <span class="hljs-variable">$table</span>) {
            <span class="hljs-variable">$table</span>-&gt;<span class="hljs-title function_ invoke__">id</span>();
            <span class="hljs-variable">$table</span>-&gt;<span class="hljs-keyword">string</span>(<span class="hljs-string">&#x27;title&#x27;</span>);    ←追加
            <span class="hljs-variable">$table</span>-&gt;<span class="hljs-title function_ invoke__">text</span>(<span class="hljs-string">&#x27;body&#x27;</span>);       ←追加
            <span class="hljs-variable">$table</span>-&gt;<span class="hljs-title function_ invoke__">timestamps</span>();
        });
    }
</code></pre>
<h4 id="ビューファイルの作成">ビューファイルの作成</h4>
<p>postフォルダを作成
resources\views\post\</p>
<p>resources\views\dashboard.blade.php ファイルをコピーして\post\create.blade.php ファイルを作成</p>
<blockquote>
<p>\resources\views&gt; copy dashboard.blade.php .\post\create.blade.php</p>
</blockquote>
<p>&lt;form&gt;内にコントロールを記述</p>
<blockquote>
<p>method=&quot;post&quot; action=&quot;{{ route('フォーム送信先のルート設定') }}</p>
</blockquote>
<pre><code class="language-php">            &lt;form method=<span class="hljs-string">&quot;post&quot;</span> action=<span class="hljs-string">&quot;{{ route(&#x27;reserve.store&#x27;) }}&quot;</span>&gt;
                @csrf
                &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;reservation_date&quot;</span>&gt;予約日:&lt;/label&gt;
                ：
            &lt;/form&gt;    
</code></pre>
<h4 id="コントローラーファイルの作成">コントローラーファイルの作成</h4>
<blockquote>
<p>&gt; php artisan make:controller PostController</p>
</blockquote>
<pre><code class="language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-comment">//Post/create.blade.phpを表示</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">view</span>(<span class="hljs-string">&quot;post.create&quot;</span>);
    }
}
</code></pre>
<pre><code class="language-php">@<span class="hljs-keyword">isset</span> (<span class="hljs-variable">$value</span>)
    <span class="hljs-comment">// $value が定義済みの場合表示する</span>
    @<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$users</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$user</span>)
        &lt;li&gt;{{ <span class="hljs-variable">$user</span>-&gt;name }}&lt;/li&gt;
        @<span class="hljs-keyword">if</span> (<span class="hljs-variable">$user</span>-&gt;id == <span class="hljs-number">5</span>)
        <span class="hljs-comment">// ループ終了</span>
            @<span class="hljs-keyword">break</span>
        @<span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$value02</span>)
        <span class="hljs-comment">// 違う条件の場合で true だった場合の表示</span>
        @<span class="hljs-keyword">else</span>
        @<span class="hljs-keyword">endif</span>
    @<span class="hljs-keyword">endforeach</span>

@endisset

@auth
    @<span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">10</span>; <span class="hljs-variable">$i</span>++)
    <span class="hljs-comment">// 繰り返し処理</span>
    {{ <span class="hljs-variable">$i</span> }} {{ <span class="hljs-title class_">Auth</span>::<span class="hljs-title function_ invoke__">user</span>()-&gt;name }}さん、をつ!
    @<span class="hljs-keyword">endfor</span>
@endauth
</code></pre>
<h2 id="コンポーネントの利用-1">コンポーネントの利用</h2>
<ul>
<li> ボタン等を構成するファイルを以下に配置</li>
yoyaku\resources\views\components\
<p>yoyaku\resources\views\dashboard.blade.php</p>
<h2 id="テンプレート-1">テンプレート</h2>
<li> 通常テンプレートの配置</li>
yoyaku\resources\views\layouts\app.blade.php
<p>Viteとは webpack、Rollup、Parcelのようなビルドツールの1つ。
これらの役割としては、プロジェクトすべてのファイルをコンパイル・結合して一つの塊（バンドル）となったファイルを生成してくれます。</p>
<pre><code class="language-php">        &lt;!-- Scripts --&gt;
        @<span class="hljs-title function_ invoke__">vite</span>([<span class="hljs-string">&#x27;resources/css/app.css&#x27;</span>, <span class="hljs-string">&#x27;resources/js/app.js&#x27;</span>])
</code></pre>
<li> app.cssには TailWind CSS の利用宣言が入る</li>
<pre><code class="language-php">@tailwind base;
@tailwind components;
@tailwind utilities;
</code></pre>
<p>app.jsには Alpine.js  の利用宣言が入る</p>
<pre><code>import './bootstrap';
import Alpine from 'alpinejs';
window.Alpine = Alpine;
Alpine.start();
</code></pre>
<h2 id="スロット定義-1">スロット定義</h2>
<li>{{ $header }} と書くと下記のheader定義内が展開される</li>
<li>{{ $slot }}と書くと下記のslot定義内が展開される</li>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">x-app-layout</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x-slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;header&quot;</span>&gt;</span>
        header文字列
    <span class="hljs-tag">&lt;/<span class="hljs-name">xslot</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x-slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;slot&quot;</span>&gt;</span>
        slotの文字列
    <span class="hljs-tag">&lt;/<span class="hljs-name">xslot</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">x-app-layout</span>&gt;</span>
</code></pre>
</ul>
<h2 id="フォームの作成-1">フォームの作成</h2>
<h4 id="モデルとマイグレーションの作成">モデルとマイグレーションの作成</h4>
<blockquote>
<p>&gt;php artisan make:model Post -m</p>
</blockquote>
<p>このコマンドにより、\app\Models と database\migrations\ に各々のphpファイルが作成される</p>
<h6 id="モデルファイル作成">モデルファイル作成</h6>
<p>\app\Models\Post.php</p>
<pre><code class="language-php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">App</span>\<span class="hljs-title class_">Models</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Database</span>\<span class="hljs-title">Eloquent</span>\<span class="hljs-title">Factories</span>\<span class="hljs-title">HasFactory</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Database</span>\<span class="hljs-title">Eloquent</span>\<span class="hljs-title">Model</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span>
</span>{
    <span class="hljs-keyword">use</span> <span class="hljs-title">HasFactory</span>;

    <span class="hljs-comment">//  保存・更新したいカラムを設定</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$filLable</span> = [
        <span class="hljs-string">&#x27;title&#x27;</span>,
        <span class="hljs-string">&#x27;body&#x27;</span>
    ];
}
</code></pre>
<h6 id="マイグレーションファイル">マイグレーションファイル</h6>
<p>database\migrations\2024_08_05_174658_create_posts_table.php</p>
<pre><code class="language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">up</span>(<span class="hljs-params"></span>): <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-title class_">Schema</span>::<span class="hljs-title function_ invoke__">create</span>(<span class="hljs-string">&#x27;posts&#x27;</span>, function (Blueprint <span class="hljs-variable">$table</span>) {
            <span class="hljs-variable">$table</span>-&gt;<span class="hljs-title function_ invoke__">id</span>();
            <span class="hljs-variable">$table</span>-&gt;<span class="hljs-keyword">string</span>(<span class="hljs-string">&#x27;title&#x27;</span>);    ←追加
            <span class="hljs-variable">$table</span>-&gt;<span class="hljs-title function_ invoke__">text</span>(<span class="hljs-string">&#x27;body&#x27;</span>);       ←追加
            <span class="hljs-variable">$table</span>-&gt;<span class="hljs-title function_ invoke__">timestamps</span>();
        });
    }
</code></pre>
<h4 id="ビューファイルの作成-1">ビューファイルの作成</h4>
<p>postフォルダを作成</p>
<blockquote>
<p>&gt; md resources\views\post\</p>
</blockquote>
<p>resources\views\dashboard.blade.php ファイルをコピーして\post\create.blade.php ファイルを作成</p>
<blockquote>
<p>\resources\views&gt; copy dashboard.blade.php .\post\create.blade.php</p>
</blockquote>
<details><summary> ＜form＞内にコントロールを記述</summary>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">x-app-layout</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x-slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;header&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;font-semibold text-xl text-gray-800 leading-tight&quot;</span>&gt;</span>
            フォーム
        <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x-slot</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;max-w-7xl mx-auto px-6&quot;</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- セッションの中に messege が含まれていれば表示する --&gt;</span>
        @if(session(&#x27;message&#x27;))
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-red-600 font-bold&quot;</span>&gt;</span>
                {{session(&#x27;message&#x27;)}}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        @endif
        <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;{{ route(&#x27;post.store&#x27;) }}&quot;</span> &gt;</span>
            <span class="hljs-comment">&lt;!--  @csrf : cross site request forgeries 攻撃を防ぐための記述 
                  ワンタイムトークンを実装する --&gt;</span>
            @csrf
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mt-8&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;w-full flex flex-col&quot;</span> &gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;title&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;font-semibold mt-4&quot;</span>&gt;</span>件名<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
                    <span class="hljs-comment">&lt;!-- エラーメッセージの実装 --&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">x-input-error</span> <span class="hljs-attr">:messages</span>=<span class="hljs-string">&quot;$errors-&gt;get(&#x27;title&#x27;)&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mt-2&quot;</span> /&gt;</span>
                    <span class="hljs-comment">&lt;!-- エラーメッセージが表示されても、前回の入力値が残るようにするには old(&#x27;項目名&#x27;) と記述 --&gt;</span>  
                    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;title&quot;</span> 
                            <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;w-atuo py-2 border border-gray-300 rounded-md&quot;</span> 
                            <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;title&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;{{old(&#x27;title&#x27;)}}&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;w-full flex flex-col&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;body&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;font-semibold mt-4&quot;</span>&gt;</span>本文<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">x-input-error</span> <span class="hljs-attr">:messages</span>=<span class="hljs-string">&quot;$errors-&gt;get(&#x27;body&#x27;)&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mt-2&quot;</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;body&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;w-auto py-2 border border-gray-300 rounded-md&quot;</span> 
                    <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;body&quot;</span> <span class="hljs-attr">cols</span>=<span class="hljs-string">&quot;30&quot;</span> <span class="hljs-attr">rows</span>=<span class="hljs-string">&quot;5&quot;</span>&gt;</span>{{old(&#x27;body&#x27;)}}&lt;/textarea &gt;
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">x-primary-button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mt-4&quot;</span>&gt;</span>
                送信する
            <span class="hljs-tag">&lt;/<span class="hljs-name">x-primary-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">x-app-layout</span>&gt;</span>
</code></pre>
</details>
<h4 id="コントローラーファイルの作成-1">コントローラーファイルの作成</h4>
<p>コントローラには入力チェック・PostならばDBの更新等とViewの呼び出し等を記述する。</p>
<h6 id="コントローラ作成コマンド">コントローラ作成コマンド</h6>
<blockquote>
<p>&gt; php artisan make:controller PostController</p>
</blockquote>
<details><summary> app\Http\Controllers\PostController.php ファイルが作成される</summary>
<pre><code>//  postモデルを使うための宣言を追加
use App\Models\Post;

class PostController extends Controller
{
    //Post/create.blade.phpを表示
    public function create() {
        return view(&quot;post.create&quot;);
    }
    public function store(Request $request) {
        //  Request は フォームから送信されたデータを受け取っており、Illuminate\Http\Request を指している

        //  入力の妥当性チェック
        $validated = $request-&gt;validate([
            //      required : 必須入力
            //      max:nn : 最大文字列
            //      'integer | between:0,150' : 数値 0～150 
            //      ['max:1', 'regex:/^[男|女]+$/u'],
            &quot;title&quot;=&gt; &quot;required|max:20&quot;,
            &quot;body&quot;=&gt; &quot;required|max:400&quot;,
            ],
            [
                //  エラーメッセージ記述
                'title.required' =&gt; 'タイトルは必須です。',
                'title.max' =&gt; 'タイトルは20文字以内。',
                'body.required' =&gt; 'bodyは必須項目です。'
            ]
        );

        //  Postモデルに沿ってPostインスタンスを作成
        //      create は resources\views\post\create.blade.php で処理される

        //  方法１　夫々の項目を引数で渡す
        if(false) {
            $post = Post::create([
                'title' =&gt; $request-&gt;title,
                'body'  =&gt; $request-&gt;body
            ]);
        }
        //  方法２　妥当性チェック済の値を渡す
        //      $validated は array(2) となっており title , body が含まれている
        $post = Post::create($validated);

        //  保存時のメッセージを表示
        $request-&gt;session()-&gt;flash('message','保存しました');
        //  処理後に元のページに戻る
        return back();
    }
}
</code></pre>
</details>
<h4 id="ルート設定を追加">ルート設定を追加</h4>
<p>routes\web.php を編集</p>
<pre><code class="language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>\<span class="hljs-title">PostController</span>;
：
<span class="hljs-comment">//  投稿入力画面</span>
<span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;post/create&#x27;</span>, [<span class="hljs-title class_">PostController</span>::<span class="hljs-variable language_">class</span>,<span class="hljs-string">&#x27;create&#x27;</span>]);
<span class="hljs-comment">//  投稿の書き込み</span>
<span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">post</span>(<span class="hljs-string">&#x27;post&#x27;</span>, [<span class="hljs-title class_">PostController</span>::<span class="hljs-variable language_">class</span>,<span class="hljs-string">&#x27;store&#x27;</span>])-&gt;<span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&#x27;post.store&#x27;</span>);
</code></pre>
<h4 id="ブラウザで表示を確認">ブラウザで表示を確認</h4>
<p><a href="http://localhost/yoyaku/public/post/create">http://localhost/yoyaku/public/post/create</a></p>
<h2 id="一覧表示画面の追加">一覧表示画面の追加</h2>
<h4 id="routeswebphp-に-httplocalhostyoyakupublicpost-への-get-アクセスを追加">routes\web.php に <a href="http://localhost/yoyaku/public/post/">http://localhost/yoyaku/public/post/</a> への get アクセスを追加</h4>
<p>PostController クラスの index() 関数を呼ぶという定義を追加</p>
<pre><code>//  投稿一覧(インデックス)
Route::get('post', [PostController::class,'index']);
</code></pre>
<h4 id="yoyakuapphttpcontrollerspostcontrollerphp-に-index-関数を追加">yoyaku\app\Http\Controllers\PostController.php に index() 関数を追加</h4>
<p>view/post/ の index.blade.php を呼び出す定義を追加</p>
<pre><code class="language-php">    <span class="hljs-comment">//  投稿一覧(インデックス)を表示</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-variable">$posts</span> = <span class="hljs-title class_">Post</span>::<span class="hljs-title function_ invoke__">all</span>();   <span class="hljs-comment">//  Postデータの一括読み込み</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">view</span>(<span class="hljs-string">&#x27;post.index&#x27;</span>,<span class="hljs-title function_ invoke__">compact</span>(<span class="hljs-string">&#x27;posts&#x27;</span>));
    }
</code></pre>
<p>データの渡し方</p>
<table border=1>
<tr><th> 渡し方</th><th >名前</th></tr>
<tr><td>['user' => $test]</td><td>変数で渡す。</td></tr>
<tr><td>->with('user', $test);</td><td>変数で渡す。</td></tr>
<tr><td>compact('user' , ...)</td><td>連想配列で渡す。</td></tr>
</table>
<h4 id="yoyakuresourcesviewspostindexbladephp-に表示方法を定義">yoyaku\resources\views\post\index.blade.php に表示方法を定義</h4>
<p>渡された $post は配列となっており、定義数分繰り返す</p>
<details><summary>index.blade.php</summary>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">x-app-layout</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x-slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;header&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;font-semibold text-xl text-gray-800 leading-tight&quot;</span>&gt;</span>
        一覧表示
        <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x-slot</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mx-auto px-6&quot;</span>&gt;</span>
    @foreach($posts as $post)
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mt-4 p-8 bg-white w-full rounded-2xl&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;p-4 text-lg font-semibold&quot;</span>&gt;</span>
                {{$post-&gt;title}}
            <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;w-full&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mt-4 p-4&quot;</span>&gt;</span>
                {{$post-&gt;body}}
            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;p-4 text-sm font-semibold&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
                    {{$post-&gt;created_at}}　/　 {{$post-&gt;user-&gt;name??&#x27;匿名&#x27;}}
                <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    @endforeach
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">x-app-layout</span>&gt;</span>
</code></pre>
</details>
<h4 id="ブラウザで表示を確認-1">ブラウザで表示を確認</h4>
<p><a href="http://localhost/yoyaku/public/post">http://localhost/yoyaku/public/post</a></p>
<h4 id="一覧表示に投稿者名の表示を追加">一覧表示に投稿者名の表示を追加</h4>
<blockquote>
<p>&gt;php artisan make:migration add_user_id_column_to_users_table --table=posts</p>
</blockquote>
<p>\database\migrations\2024_08_15_160354_add_user_id_column_to_users_table.php</p>
<pre><code class="language-php">   <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">up</span>(<span class="hljs-params"></span>): <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-title class_">Schema</span>::<span class="hljs-title function_ invoke__">table</span>(<span class="hljs-string">&#x27;posts&#x27;</span>, function (Blueprint <span class="hljs-variable">$table</span>) {
            <span class="hljs-comment">//  postsテーブルに リレーション用の &#x27;user_id&#x27; カラムを追加</span>

            <span class="hljs-comment">//  従来の方法 </span>
            <span class="hljs-comment">// $table-&gt;unsignedBigInteger(&#x27;user_id&#x27;);       // user_id カラムを追加</span>
            <span class="hljs-comment">// $table-&gt;foreign(&#x27;user_id&#x27;)-&gt;references(&#x27;id&#x27;)-&gt;on(&#x27;users&#x27;);  // users テーブルの idとリレーション追加</span>

            <span class="hljs-comment">//  新たな方法</span>
            <span class="hljs-variable">$table</span>-&gt;<span class="hljs-title function_ invoke__">foreignId</span>(<span class="hljs-string">&#x27;user_id&#x27;</span>);
        });
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">down</span>(<span class="hljs-params"></span>): <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-title class_">Schema</span>::<span class="hljs-title function_ invoke__">table</span>(<span class="hljs-string">&#x27;posts&#x27;</span>, function (Blueprint <span class="hljs-variable">$table</span>) {
            <span class="hljs-comment">//</span>
            <span class="hljs-variable">$table</span>-&gt;<span class="hljs-title function_ invoke__">dropColumn</span>(<span class="hljs-string">&#x27;user_id&#x27;</span>);
        });
    }
</code></pre>
<blockquote>
<p>&gt; php artisan migrate</p>
</blockquote>
<p>user_id の設定処理を追加
\app\Http\Controllers\PostController.php</p>
<pre><code class="language-php">        <span class="hljs-comment">//  user_id の設定を追加</span>
        <span class="hljs-variable">$validated</span>[<span class="hljs-string">&#x27;user_id&#x27;</span>] = <span class="hljs-title function_ invoke__">auth</span>()-&gt;<span class="hljs-title function_ invoke__">id</span>();
</code></pre>
<p>\app\Models\Post.php</p>
<pre><code class="language-php">    <span class="hljs-comment">//  保存・更新したいカラムを設定</span>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$fillable</span> = [
        <span class="hljs-string">&#x27;title&#x27;</span>,
        <span class="hljs-string">&#x27;body&#x27;</span>,
        <span class="hljs-string">&#x27;user_id&#x27;</span>   <span class="hljs-comment">// 追加</span>
    ];
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">user</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">belongsTo</span>(<span class="hljs-title class_">User</span>::<span class="hljs-variable language_">class</span>);
    }
</code></pre>
<p>\app\Models\User.php</p>
<pre><code class="language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">posts</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-comment">//  1 対多のリレーションでは hasMany を使用</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">hasMany</span>(<span class="hljs-title class_">Post</span>::<span class="hljs-variable language_">class</span>);

        <span class="hljs-comment">//  1対1では hasOne を使う</span>
    }
</code></pre>
<p>\resources\views\post\index.blade.php</p>
<pre><code class="language-php">            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">p</span>-4 <span class="hljs-title">text</span>-<span class="hljs-title">sm</span> <span class="hljs-title">font</span>-<span class="hljs-title">semibold</span>&quot;&gt;
                &lt;<span class="hljs-title">p</span>&gt;
                    </span>{{<span class="hljs-variable">$post</span>-&gt;created_at}}　/　 {{<span class="hljs-variable">$post</span>-&gt;user-&gt;name??<span class="hljs-string">&#x27;匿名&#x27;</span>}}
                &lt;/p&gt;
            &lt;/div&gt;
</code></pre>
<h4 id="データの絞込">データの絞込</h4>
<p>\app\Http\Controllers\PostController.php</p>
<pre><code class="language-php"><span class="hljs-comment">//  クエリビルダの使用・フォサード宣言</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">DB</span>;
　：
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
　：
   <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-comment">//$posts = Post::all();   //  Postデータの一括読み込み</span>
        <span class="hljs-variable">$posts</span> = DB::<span class="hljs-title function_ invoke__">table</span>(<span class="hljs-string">&#x27;posts&#x27;</span>)-&gt;<span class="hljs-title function_ invoke__">get</span>();     <span class="hljs-comment">//  クエリビルダを使用した読み込み</span>
        <span class="hljs-variable">$posts</span> = <span class="hljs-title class_">Post</span>::<span class="hljs-title function_ invoke__">with</span>(<span class="hljs-string">&#x27;user&#x27;</span>)-&gt;<span class="hljs-title function_ invoke__">get</span>();     <span class="hljs-comment">//  Eagerロードを使用した読み込み</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">view</span>(<span class="hljs-string">&#x27;post.index&#x27;</span>,<span class="hljs-title function_ invoke__">compact</span>(<span class="hljs-string">&#x27;posts&#x27;</span>));
    }
</code></pre>
<p>Eloquent ORM を使用して where 条件を指定する</p>
<p>\app\Http\Controllers\PostController.php</p>
<pre><code class="language-php">        <span class="hljs-variable">$posts</span> = <span class="hljs-title class_">Post</span>::<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">&#x27;user_id&#x27;</span>,<span class="hljs-title function_ invoke__">Auth</span>()-&gt;<span class="hljs-title function_ invoke__">id</span>())-&gt;<span class="hljs-title function_ invoke__">get</span>();     <span class="hljs-comment">//  自分の投稿だけ</span>
        <span class="hljs-variable">$posts</span> = <span class="hljs-title class_">Post</span>::<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">&#x27;user_id&#x27;</span>,<span class="hljs-string">&#x27;!=&#x27;</span>,<span class="hljs-title function_ invoke__">Auth</span>()-&gt;<span class="hljs-title function_ invoke__">id</span>())-&gt;<span class="hljs-title function_ invoke__">get</span>();     <span class="hljs-comment">//  自分の投稿以外</span>
        <span class="hljs-variable">$posts</span> = <span class="hljs-title class_">Post</span>::<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">&#x27;created_at&#x27;</span>,<span class="hljs-string">&#x27;&gt;=&#x27;</span>,<span class="hljs-string">&#x27;2022-12-02&#x27;</span>)-&gt;<span class="hljs-title function_ invoke__">get</span>();     <span class="hljs-comment">//  指定日付以降</span>

</code></pre>
<h2 id="ミドルウェア">ミドルウェア</h2>
<p>ミドルウェアとは、コントローラが実行される前後に配置する処理で、前処理ミドルウェアと後処理ミドルウェアと呼ぶ。</p>
<p>app\Http\Kernel.php</p>
<pre><code class="language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Kernel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpKernel</span>
</span>{
　　　：
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$middleware</span> = [
        ディフォルトで有効なミドルウェアを記述
        <span class="hljs-title class_">\App\Http\Middleware\TrimStrings</span>::<span class="hljs-variable language_">class</span>,
    ];

    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$middlewareGroups</span> = [
        指定したグループで有効なミドルウェア
        <span class="hljs-string">&#x27;web&#x27;</span> =&gt; [
            routes\web.php　で有効なミドルウェア
        ],

        <span class="hljs-string">&#x27;api&#x27;</span> =&gt; [
            routes\api.php　で有効なミドルウェア
        ],
    ];

    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$middlewareAliases</span> = [
        設定が必要なミドルウェア
    ];
</code></pre>
<p>routes\web.php</p>
<pre><code class="language-php"><span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, function () {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">view</span>(<span class="hljs-string">&#x27;welcome&#x27;</span>);
})-&gt;<span class="hljs-title function_ invoke__">middleware</span>(<span class="hljs-string">&#x27;auth&#x27;</span>);　　← 追加
</code></pre>
<h4 id="管理者のみがアクセス可能にする">管理者のみがアクセス可能にする</h4>
<h6 id="role-カラムを追加">role カラムを追加</h6>
<blockquote>
<p>php artisan make:migration add_role_clumn_to_users_table --table=users</p>
</blockquote>
<p>作成されたファイル
database\migrations\2024_08_20_153850_add_role_clumn_to_users_table.php</p>
<pre><code class="language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">up</span>(<span class="hljs-params"></span>): <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-title class_">Schema</span>::<span class="hljs-title function_ invoke__">table</span>(<span class="hljs-string">&#x27;users&#x27;</span>, function (Blueprint <span class="hljs-variable">$table</span>) {
            <span class="hljs-variable">$table</span>-&gt;<span class="hljs-keyword">string</span>(<span class="hljs-string">&#x27;role&#x27;</span>)-&gt;<span class="hljs-title function_ invoke__">after</span>(<span class="hljs-string">&#x27;name&#x27;</span>)-&gt;<span class="hljs-title function_ invoke__">nullable</span>();
        });
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">down</span>(<span class="hljs-params"></span>): <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-title class_">Schema</span>::<span class="hljs-title function_ invoke__">table</span>(<span class="hljs-string">&#x27;users&#x27;</span>, function (Blueprint <span class="hljs-variable">$table</span>) {
            <span class="hljs-variable">$table</span>-&gt;<span class="hljs-title function_ invoke__">dropColumn</span>(<span class="hljs-string">&#x27;role&#x27;</span>);
        });
    }
</code></pre>
<h6 id="middlewareの判定処理を追加">MiddleWareの判定処理を追加</h6>
<blockquote>
<p>php artisan make:middleware RoleMiddleware</p>
</blockquote>
<p>app\Http\Middleware\RoleMiddleware.php が作成される</p>
<pre><code class="language-php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">App</span>\<span class="hljs-title class_">Http</span>\<span class="hljs-title class_">Middleware</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Closure</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Response</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoleMiddleware</span>
</span>{
    <span class="hljs-comment">/**
     * Handle an incoming request.
     *
     * <span class="hljs-doctag">@param</span>  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span>, <span class="hljs-built_in">Closure</span> <span class="hljs-variable">$next</span></span>): <span class="hljs-title">Response</span>
    </span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">auth</span>()-&gt;<span class="hljs-title function_ invoke__">user</span>()-&gt;role == <span class="hljs-string">&#x27;admin&#x27;</span>) {
            <span class="hljs-comment">//  ログインユーザの role が &#x27;admin&#x27; ならリクエストを実行</span>
            <span class="hljs-keyword">return</span> <span class="hljs-variable">$next</span>(<span class="hljs-variable">$request</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">redirect</span>()-&gt;<span class="hljs-title function_ invoke__">route</span>((<span class="hljs-string">&#x27;dashboard&#x27;</span>));
    }
}
</code></pre>
<p>app\Http\Kernel.php</p>
<pre><code class="language-php">    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$middlewareAliases</span> = [
　　　　　　：
        <span class="hljs-string">&#x27;admin&#x27;</span> =&gt; <span class="hljs-title class_">\App\Http\Middleware\RoleMiddleware</span>::<span class="hljs-variable language_">class</span>,
　　　　　　：
</code></pre>
<h2 id="データ変更画面の追加">データ変更画面の追加</h2>
<h4 id="route設定">route設定</h4>
<p>routes\web.php　に /edit/ を追加</p>
<blockquote>
<p>Route::get('reserve/edit/{reserve}', [ReserveController::class,'edit'])-&gt;name('reserve.edit');</p>
</blockquote>
<p>{reserve} には呼び出し元画面で読み込まれているJSON定義が渡されてくる</p>
<h4 id="contloer設定">contloer設定</h4>
<p>引数を 'reserve' として Viewに渡す</p>
<pre><code class="language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">edit</span>(<span class="hljs-params">Reserve <span class="hljs-variable">$reserve</span></span>) </span>{
        <span class="hljs-comment">//return view(&quot;Reserve.RUpdate&quot;,compact(&#x27;reserve&#x27;));</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">view</span>(<span class="hljs-string">&quot;Reserve.REdit&quot;</span>,<span class="hljs-title function_ invoke__">compact</span>(<span class="hljs-string">&#x27;reserve&#x27;</span>));
    }
</code></pre>
<h4 id="modelに日付フィールドであることを定義する">Modelに日付フィールドであることを定義する</h4>
<p>これを行わないと、全て文字列型の yyyy/mm/dd となる。
Viewで日付項目に初期値として設定するためには　yyyy-mm-dd 形式とする必要がある</p>
<pre><code class="language-php">    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$casts</span> = [
        <span class="hljs-string">&#x27;ReqDate&#x27;</span> =&gt; <span class="hljs-string">&#x27;datetime&#x27;</span>,
        <span class="hljs-string">&#x27;ReserveDate&#x27;</span> =&gt; <span class="hljs-string">&#x27;datetime&#x27;</span>,
    ];
</code></pre>
<h4 id="view設定">view設定</h4>
<p>resources\views\Reserve\REdit.blade.php</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/sample/index&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span>
    @method(&#x27;patch&#x27;)
    @csrf
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;ClitNameKanji&quot;</span>&gt;</span>テキストボックス:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ClitNameKanji&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ClitNameKanji&quot;</span> <span class="hljs-attr">required</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;{{ old(&#x27;ClitNameKanji&#x27;,$reserve-&gt;ClitNameKanji) }}&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;reservation_date&quot;</span>&gt;</span>日時:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;datetime-local&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ReserveDate&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ReserveDate&quot;</span> <span class="hljs-attr">required</span> 
            <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;{{ old(&#x27;ReserveDate&#x27;,$reserve-&gt;ReserveDate) }}&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;CliResvType&quot;</span>&gt;</span>ドロップダウンリスト :<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;CliResvType&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;CliResvType&quot;</span> <span class="hljs-attr">required</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> {{ <span class="hljs-attr">old</span>(&#x27;<span class="hljs-attr">field_name</span>&#x27;, $<span class="hljs-attr">reserve-</span>&gt;</span>CliResvType) == &#x27;1&#x27; ? &#x27;selected&#x27; : &#x27;&#x27; }}&gt;タイプ1<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;2&quot;</span> {{ <span class="hljs-attr">old</span>(&#x27;<span class="hljs-attr">field_name</span>&#x27;, $<span class="hljs-attr">reserve-</span>&gt;</span>CliResvType) == &#x27;2&#x27; ? &#x27;selected&#x27; : &#x27;&#x27; }}&gt;タイプ2<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>


    　：
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">text</span>=<span class="hljs-string">&quot;提出&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
</code></pre>
<p>@method('patch')と書くと、以下のhtmlが追加される</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;_method&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;patch&quot;</span>&gt;</span>
</code></pre>
<h6 id="old関数を使い変更前の値を表示させる">old()関数を使い、変更前の値を表示させる</h6>
<p>テキストボックスの場合</p>
<blockquote>
<p>value=&quot;{{ old('ClitNameKanji',$reserve-&gt;ClitNameKanji) }}&quot;</p>
</blockquote>
<h1 id="コンポーネントの追加">コンポーネントの追加</h1>
<p>コンポーネントを追加するには以下のコマンドを入力する</p>
<blockquote>
<p>php artisan make:component Message</p>
</blockquote>
<p>コマンドを実行すると、以下２つのファイルが作成される</p>
<li>コンポーネント：yoyaku\app\View\Components\Message.php</li>
<li>View : yoyaku\resources\views\components\message.blade.php</li>
<h4 id="コンポーネント">コンポーネント</h4>
<p>yoyaku\app\View\Components\Message.php</p>
<pre><code class="language-php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">App</span>\<span class="hljs-title class_">View</span>\<span class="hljs-title class_">Components</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Closure</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">View</span>\<span class="hljs-title">View</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">View</span>\<span class="hljs-title">Component</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Message</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$message</span>;    <span class="hljs-comment">//　←メンバ変数を追加</span>

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$message</span></span>) 
    </span>{   <span class="hljs-comment">//  コンストラクタで表示するメッセージ文を受け取る</span>
        <span class="hljs-variable language_">$this</span>-&gt;message = <span class="hljs-variable">$message</span>;  
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params"></span>): <span class="hljs-title">View</span>|<span class="hljs-title">Closure</span>|<span class="hljs-title">string</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">view</span>(<span class="hljs-string">&#x27;components.message&#x27;</span>);
    }
}
</code></pre>
<h4 id="view">View</h4>
<p>yoyaku\resources\views\components\message.blade.php</p>
<pre><code class="language-php">@<span class="hljs-keyword">if</span>(<span class="hljs-variable">$message</span>)
&lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">p</span>-4 <span class="hljs-title">m</span>-2 <span class="hljs-title">rounded</span> <span class="hljs-title">bg</span>-<span class="hljs-title">green</span>-100&quot;&gt;
    </span>{{ <span class="hljs-variable">$message</span> }}
&lt;/div&gt;
@<span class="hljs-keyword">endif</span>
</code></pre>
<h4 id="使用するviewファイルに以下の定義を追加する">使用するViewファイルに以下の定義を追加する</h4>
<pre><code class="language-php">        &lt;x-message :message=<span class="hljs-string">&quot;session(&#x27;message&#x27;)&quot;</span> /&gt;
</code></pre>
<p>コンポーネントを呼び出すbladeファイルでは、タグ形式でコンポーネントを呼び出します。
タグ名はコンポーネント名をケバブケースにして頭に「x-」をつけたものになります。
（例：コンポーネント名がComponentTestの場合、タグ名はx-component-test）</p>
<p>パラメータは属性として渡しますが、属性名もケバブケースで表現します。
（例：コンポーネント側のパラメータ名がtestTitleの場合、属性名はtest-title）</p>
<pre><code class="language-php">①    &lt;x-rtextbox  inputName=<span class="hljs-string">&quot;ClitNameKanji&quot;</span>&gt;氏名（漢字）&lt;/x-rtextbox&gt;
②    &lt;x-rtextbox :inputName=<span class="hljs-string">&quot;ClitNameKanji&quot;</span>&gt;氏名（漢字）&lt;/x-rtextbox&gt;
③    &lt;x-rtextbox :inputName=<span class="hljs-string">&quot;<span class="hljs-subst">$ClitNameKanji</span>&quot;</span>&gt;氏名（漢字）&lt;/x-rtextbox&gt;
</code></pre>
<p>①のように属性名にコロンが付いていない場合にはパラメータには文字列のClitNameKanjiが渡される。
②のようにコロンを付けた場合には固定数のClitNameKanjiが渡される。
③のようにコロンを付けた場合には、コントローラから渡された変数の$ClitNameKanjiが渡される。</p>
<p>本日日付など、関数を呼び出したい場合もコロン付きとする</p>
<pre><code class="language-php">                &lt;x-rtextbox name=<span class="hljs-string">&quot;ReserveDate&quot;</span> type=<span class="hljs-string">&quot;datetime-local&quot;</span> 
                    :value=<span class="hljs-string">&quot;date(&#x27;Y-m-d 07:00&#x27;)&quot;</span> required&gt;予約日:&lt;/x-rtextbox&gt;
</code></pre>
<h4 id="エラーunresolvable-dependency-resolving-が表示される場合">エラー「Unresolvable dependency resolving ･･･」が表示される場合</h4>
<blockquote>
<p>Unresolvable dependency resolving [Parameter #0 [ <required> $name ]] in class App\View\Components\Alert (View: /...path.../resources/views/welcome.blade.php)</p>
</blockquote>
<p>ブラウザで「キャッシュの消去と再読み込み」を行うと解消される</p>
<h2 id="helper関数の追加">helper関数の追加</h2>
<p>ヘルパー関数ファイルを追加
yoyaku\app\helpers.php</p>
<p>ヘルパー関数としてファイルを登録
yoyaku\composer.json</p>
<pre><code class="language-json"><span class="hljs-attr">&quot;autoload&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;psr-4&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">&quot;App\\&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;app/&quot;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">&quot;Database\\Factories\\&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;database/factories/&quot;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">&quot;Database\\Seeders\\&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;database/seeders/&quot;</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;files&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span> 
        <span class="hljs-string">&quot;app/helpers.php&quot;</span> 
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
</code></pre>
<p>プロジェクトに反映</p>
<blockquote>
<p>composer dump-autoload</p>
</blockquote>
<pre><code>                    value=&quot;{{ old('ReserveDate',&quot;&lt;?php echo substr($reserve-&gt;ReserveDate,0,10); ?&gt;&quot;) }}&quot;&gt;&lt;br&gt;
                    value=&quot;&lt;?php echo substr($reserve-&gt;ReserveDate,0,10); ?&gt;&quot;&gt;&lt;br&gt;

       &lt;form method=&quot;post&quot; action=&quot;{{ isset($reserve) ?? route('reserve.store') :: route('reserve.update') }}&quot;&gt;
</code></pre>
<p>vendor\illuminate\collections\helpers.php</p>
<p>date('Y-m-d', strtotime('-1 month'));</p>
<pre><code>                :value=&quot;&lt;?php echo date('Y-m-d 07:00');?&gt;&quot; required&gt;予約日:&lt;/x-rtextbox&gt;
                value=&quot;2024-09-23 07:00&quot; required&gt;予約日:&lt;/x-rtextbox&gt;

            &lt;x-rtextbox name=&quot;ReserveDate&quot; type=&quot;datetime-local&quot; 
                :value=&quot;date('Y-m-d 07:00')&quot; required&gt;予約日:&lt;/x-rtextbox&gt;



&lt;!-- button id=&quot;downloadBtn&quot;&gt;HTMLをダウンロード&lt;/button&gt;

&lt;script&gt;
    document.getElementById('downloadBtn').addEventListener('click', function() {
        // ページ全体のHTMLを取得
        let html = document.documentElement.outerHTML;
        
        // ダウンロード用のリンクを作成
        let blob = new Blob([html], { type: 'text/html' });
        let link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'page.html';
        link.click();
    });
&lt;/script --&gt;
</code></pre>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>