#ä»¥ä¸‹ã®é–¢æ•°ã§ 
             $ProductInf = UserProduct::find($ProductID);

ã¨ãªã£ã¦ã„ã‚‹ã¨ã“ã‚ã‚’ 
baseCode = user_id ã§ã®æŠ½å‡ºã«ã—ã€$ProductListã€€ã«æ ¼ç´

#Viewè¡¨ç¤ºã¯
return view("Reserve.RCalender", compact('month', 'ShopInf', 'ProductInf'));
ã‹ã‚‰
return view("Reserve.RCalender", compact('month', 'ShopInf', 'ProductList','ProductID'));
ã«å¤‰æ›´


    /**
     * äºˆç´„ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º
     */
    public function calender(Request $request, $user_id = null, $product_id = null)
    {
        // 1. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æ ¼ç´
        if ($user_id !== null) {
            $request->session()->put('ShopID', $user_id);
        }
        if ($product_id !== null) {
            $request->session()->put('ProductID', $product_id);
        }
        $month = date('Y-m-d');

        // 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰IDã‚’å–å¾—
        $ShopID = $request->session()->get('ShopID');
        $ProductID = $request->session()->get('ProductID');


        // 3. åº—èˆ—æƒ…å ±ã¨å•†å“æƒ…å ±ã®å–å¾—
        // $ShopIDãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
        if (!$ShopID) {
            return redirect()->route('profile.homelist');
        }
        
        $ShopInf = User::find($ShopID);
        $ProductInf = null;

        if ($ProductID) {
             // å•†å“IDãŒå­˜åœ¨ã™ã‚‹å ´åˆã€å•†å“æƒ…å ±ã‚’å–å¾—
             $ProductInf = UserProduct::find($ProductID);
             // å–å¾—ã§ããªã‹ã£ãŸå ´åˆã‚‚è€ƒæ…®
             if (!$ProductInf) {
                 // ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¾ãŸã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’æ¤œè¨
             }
        }
        
        // 4. ä¸è¶³ã—ã¦ã„ã‚‹ãƒã‚§ãƒƒã‚¯
        if(!$ShopInf) {
            // $ShopIDãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã‚ã‚ŠãªãŒã‚‰ç„¡åŠ¹ãªå ´åˆã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
            return redirect()->route('profile.homelist');
        }

        // ä»Šå¾Œã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼ã§ $ShopInf ã¨ $ProductInf ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã« compact ã«è¿½åŠ 
        return view("Reserve.RCalender", compact('month', 'ShopInf', 'ProductInf'));
    }







#ä»¥ä¸‹ã®Viewã«å¯¾ã—ã¦ ProductInf å‡¦ç†ã‚’å¤‰æ›´

<x-app-layout :ShopInf="$ShopInf" >
    <x-slot name="header">
        <x-article-title caption="{{ __('Shop Calender') }}" />
    </x-slot>

    <link href="{{ asset('css\calender.css') }}" rel="stylesheet">

    <!-- p>ç¾åœ¨ã®ãƒ•ã‚©ãƒ«ãƒ€: {{ getcwd() }}<br>
            URL:{{ Request::url() }}<br>
            asset:{{ asset('images/backimage1.jpg') }}</p-->
    <div class="py-12">

        @livewireStyles

        <div class="card">
            <div class="card-header" style="text-align: center;">
                - {{ $ShopInf->spName }}ï¼š{{ $ProductInf->productName }} äºˆç´„ -
            </div>
            <!-- livewire:shopclosedmodal 'ShopInf','ProductInf'/-->
            @livewireScripts
            
            <div class="card-body">
                <ul>
                    <li>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚ˆã‚Šã€ã”å¸Œæœ›ã®äºˆç´„æ—¥ã‚’ãŠé¸ã³ãã ã•ã„ã€‚</li>
                    <li>äºˆç´„æ—¥ã¯æ¬¡å›äºˆç´„ã®ã¿ãŠå–ã‚Šã„ãŸã ã‘ã¾ã™ã€‚</li>
                </ul>

                <div class="calender">
                    <form class="prev-next-form"></form>
                    <table class="calender">
                        <thead>
                        <tr>
                            <td colspan="2">
                                <div class="allow_box">
                                    <label  class="arrow-left">
                                        <a href="#" class="dateLink" id="date_befor_link" onclick="GetYoyakuCalender( '{{ calendar_culc($month,-1) }}' )">å‰æœˆ</a>
                                    </label>
                                </div>
                            </td>
                            <th colspan="3">
                                <label  class="text-center" id="date_month">
                                    {{ date('Y',strtotime($month)) }}å¹´{{ date('m', strtotime($month)) }}æœˆ
                                </label>
                            </th>
                            <td colspan="2">
                                <div class="allow_box">
                                    <label  class="arrow-right">
                                            <a href="#" class="dateLink" id="date_after_link" onclick="GetYoyakuCalender( '{{ calendar_culc($month,+1) }}' )">æ¬¡æœˆ</a>
                                    </label>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th class="sun"><div class="weekday">æ—¥</div></th>
                            <th class="mon"><div class="weekday">æœˆ</div></th>
                            <th class="tue"><div class="weekday">ç«</div></th>
                            <th class="wed"><div class="weekday">æ°´</div></th>
                            <th class="thu"><div class="weekday">æœ¨</div></th>
                            <th class="fri"><div class="weekday">é‡‘</div></th>
                            <th class="sat"><div class="weekday">åœŸ</div></th>
                        </tr>
                        </thead>
                        <tbody id="calenderTable">
                        </tbody>
                    </table>

                    <script>
                    var CurrYM = '{{ $month }}';
                    const today= new Date();
                    const todayYY = today.getFullYear();
                    const todayMM = ('0' + (today.getMonth() + 1)).slice(-2); // æœˆã¯0ã‹ã‚‰å§‹ã¾ã‚‹ãŸã‚+1ã—ã€æ¡æ•°ã‚’2æ¡ã«èª¿æ•´
                    const todayDD = ('0' + today.getDate()).slice(-2);

                    var opetbl = [];
                    @foreach ( \App\Models\ReserveDate::GetOperating() as $item) 
                    opetbl.push({code: {{ $item[0] }},name: '{{ $item[1] }}' });
                    @endforeach

                    function getOpeName(code) {
                        const foundItem = opetbl.find(item => item.code === code);
                        return foundItem ? foundItem.name : "æœªå®šç¾©";    
                    }

                    GetYoyakuCalender(CurrYM);  //  åˆå›ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º
                    function calendar_culc(reqYM,numMonth){
                        // DateTimeã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
                        const [year, month] = reqYM.split('-');
                        const date = new Date(year, month - 1, 1);

                        // å‰ã®æœˆã®æœ«æ—¥ã‚’å–å¾—
                        date.setMonth(date.getMonth() + numMonth);
                        const lastDayOfPreviousMonth = new Date(date.getFullYear(), date.getMonth() + 1, 0);

                        // å¹´ã¨æœˆã‚’å–å¾—
                        const previousYear = lastDayOfPreviousMonth.getFullYear();
                        const previousMonth = lastDayOfPreviousMonth.getMonth() + 1;

                        return `${previousYear}-${previousMonth.toString().padStart(2, '0')}`;
                    }

                    function GetYoyakuCalender(reqYM) {
                        CurrYM = reqYM;
                        const [reqYY, reqMM, reqDD] = reqYM.split('-');
                        chkDD = 0;
                        if((reqYY == todayYY) && (reqMM == todayMM)) {
                            chkDD = todayDD;
                        }

                        // æ—¢å­˜ã®tbodyè¦ç´ ã‚’å‰Šé™¤
                        const tbody = document.getElementById('calenderTable'); // idãŒ'calenderTable'ã®tbodyè¦ç´ ã‚’æƒ³å®š
                        while (tbody.firstChild) {    // tbodyã®å­è¦ç´ ãŒãªããªã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—
                            tbody.removeChild(tbody.firstChild);
                        }
                        document.getElementById('date_month').textContent = reqYY + 'å¹´ã€€' + reqMM + 'æœˆ';

                        // å‰æœˆã¸ã®ãƒªãƒ³ã‚¯ã‚’æ›¸ãæ›ãˆ
                        const dateBeforLink = document.getElementById('date_befor_link');
                        dateBeforLink.onclick = function() {
                            var strLink = calendar_culc( reqYM,-1);
                            GetYoyakuCalender(strLink);
                        };

                        // æ¬¡æœˆã¸ã®ãƒªãƒ³ã‚¯ã‚’æ›¸ãæ›ãˆ
                        const dateAfterLink = document.getElementById('date_after_link');
                        dateAfterLink.onclick = function() {
                            var strLink = calendar_culc( reqYM,+1);
                            GetYoyakuCalender(strLink);
                        };

                        let clsAry = ["sun","mon","tue","wed","thu","fri","sat"];
                        var calendarDiv = document.getElementById('calenderTable');
                        /*  var calendarAry =  @#json($calender); å‘¼ã³å‡ºã—å…ƒã‹ã‚‰ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—*/
                        const maxYoyaku = 16;
                        $.ajax({
                            url: '{{ route('reserve.calenderGet') }}', // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹URL
                            type: 'GET',
                            data: {
                                basecode  : {{ $ShopInf->id }},
                                ProductID : {{ $ProductInf->id }},
                                month   : reqYM
                            },                            
                            success: function(response) {
                                // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰è¿”ã£ã¦ããŸãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†
                                console.log(response);

                                calendarAry = response;

                                var weekStr=""; //  ç·¨é›†å…ˆæ–‡å­—åˆ—
                                var dayIx = 0;
                                var weekIx = 0;
                                const template = document.createElement('template');
                                calendarAry.forEach(function(weekAry) {

                                    weekStr="<tr>"; //  ç·¨é›†å…ˆæ–‡å­—åˆ—
                                    weekAry.forEach(function(dayInfo) {     //  ä¸€é€±é–“åˆ†ã¥ã¤ç·¨é›†
                                        weekStr+='<td><div class="area" id="area' + dayIx + '">';

                                        if(dayInfo.day > 0) {       
                                            if(dayInfo.day == chkDD) {
                                                weekStr += '<div class="day_today">' + dayInfo.day + '</div>';
                                            } else {
                                                weekStr += '<div class="day">' + dayInfo.day + '</div>';
                                            }

                                            operatingCode = 1;  
                                            if ("operating" in dayInfo) {
                                                operatingCode = dayInfo.operating;
                                            }

                                            var zanSeki = maxYoyaku - dayInfo.totalCnt;
                                            editBtnStyle = 'class="edit_button ';
                                            switch(operatingCode) {
                                            case 1:
                                                editBtnStyle += 'edit_button_normal';
                                                break;
                                            case 2:
                                                editBtnStyle += 'edit_button_horiday';
                                                break;
                                            case 3:
                                                editBtnStyle += 'edit_button_private';
                                                break;
                                            }
                                            editBtnDef = '<div class="edit_button ' + editBtnStyle + '">' + getOpeName(operatingCode) + '</div>'
                                            @auth
                                                @if(Auth::user()->id == $ShopInf->id)
                                                    //weekStr += '<button class="cnt" id="Yoyaku' + dayInfo.day + 
                                                    //           '" onclick="openYoyakuInput(' + dayInfo.day + 
                                                    //           ')">zanSeki</button>';
                                                    editBtnDef = '<button ' + editBtnStyle + '" onclick=\'openEditModal(' + dayIx + ',"' + dayInfo.day + '")\'>' + getOpeName(operatingCode) + '</button>';
                                                @endif
                                            @endauth

                                            weekStr += editBtnDef + '<div class="names">';   //  äºˆç´„è€…ãƒªã‚¹ãƒˆ
                                            if(dayInfo.totalCnt > 0) {
                                                //  äºˆç´„è€…ãŒã„ã‚‹å ´åˆã€åå‰ãƒ»äººæ•°ã¨ãƒªãƒ³ã‚¯ã‚’è¿½åŠ 
                                                var memCnt = 0;
                                                dayInfo.member.forEach(function(member) {
                                                    if(memCnt > 0) {
                                                        weekStr += '<br>';
                                                    }
                                                    weekStr += member.name + ':' + member.cnt;
                                                    memCnt++;
                                                })
                                            }
                                            else {
                                                weekStr += "ã€€ã€€ã€€ã€€ã€€";
                                            }
                                            weekStr += '</div>';
                                            weekStr += '<div class="yoyaku_cnt">' + zanSeki + '</div>';
                                    
                                            if((operatingCode == 1) && (dayInfo.day > chkDD)) {   //  æ˜æ—¥ä»¥é™ãªã‚‰ã°äºˆç´„ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                                                weekStr += '<button class="yoyaku_button" id="Yoyaku' + dayInfo.day + 
                                                           '" onclick="openYoyakuInput(' + dayInfo.day + ')" ';  
                                                if(zanSeki <= 0) {
                                                    weekStr += 'disabled';
                                                }
                                                weekStr += '>äºˆç´„</button>';  
                                            }
                                        }

                                        //  æ ã®çµ‚ã‚ã‚Š
                                        weekStr+='</div></td>';

                                        dayIx++;
                                    })
                                    weekStr+='</tr>';
                                    template.innerHTML = weekStr;
                                    content = template.content;
                                    calendarDiv.appendChild(content);
                                    weekIx++;
                                })
                            },
                            error: function(error) {
                                // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã®å‡¦ç†
                                console.error(error);
                            }
                        });
                    }
                    function openYoyakuInput(day) {
                        //  YYYY-MM-DD ã«ç·¨é›†
                        var reqDate = CurrYM.substr(0,8) + '-' + ('00' + day).slice(-2);

                        //  æ–°è¦ç”»é¢ã¸ã®URL
                        const newUrl = '{{ Route('reserve.create') }}/{{ $ShopInf->id }}/{{ $ProductInf->id }}/' + reqDate ;
                        window.location.href = newUrl;            // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
                    }
                    function updateButtonColor(area,data) {

                        const selIx = Number(data.operating);
                        const editButton = area.querySelector('.edit_button');      // area å†…ã® edit_button ã‚’å–å¾—
                        const yoyakulabel = area.querySelector("[id^='Yoyaku']");   // area å†…ã® edit_button ã‚’å–å¾—
                        const daylabel = area.querySelector('.day');                // area å†…ã® edit_button ã‚’å–å¾—
                        {{-- æ—¢å­˜ã®è‰²ã‚¯ãƒ©ã‚¹ã‚’ã™ã¹ã¦å‰Šé™¤ã™ã‚‹ --}}
                        editButton.classList.remove('edit_button_normal', 'edit_button_horiday', 'edit_button_private');
                        var newText = 'æœªå®šç¾©';
                        
                        // opetblã‹ã‚‰å¯¾å¿œã™ã‚‹ã‚¨ãƒ³ãƒˆãƒªã‚’æ¢ã™
                        const operation = opetbl.find(item => item.code === selIx);
                        if (operation) {
                            newText = operation.name;
                        }
                        switch (selIx) {
                        case 1:
                            editButton.classList.add('edit_button_normal');
                            break;
                        case 2:
                            editButton.classList.add('edit_button_horiday');
                            break;
                        case 3:
                            editButton.classList.add('edit_button_private');
                            break;
                        default:
                            editButton.style.backgroundColor = ''; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è‰²ã‚’ã‚¯ãƒªã‚¢
                        }
                        // ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã®ç½®ãæ›ãˆ
                        editButton.textContent = newText;

                        if (yoyakulabel) {
                            if((selIx == 1) && (todayDD > daylabel.textContent)) {
                                yoyakulabel.style.visibility = ''; // ã¾ãŸã¯ 'visible'
                            } else {
                                yoyakulabel.style.visibility = 'hidden';
                            }
                        }
                        {{-- classå yoyaku_cnt ã‚’æ¢ã™ --}}
                        const yoyakuCntElement = area.querySelector('.yoyaku_cnt'); 
                        yoyakuCntElement.textContent = data.yoyakusu;
                    }                                    
                    
                    </script>
                    <!-- ãƒ€ã‚¤ã‚¢ãƒ­ã‚°æœ¬ä½“ -->
                    <div id="easyModal" class="modal">
                        <div class="modal-content">
                            <input type="hidden" id="dayIx">
                            <input type="hidden" id="id">
                            <input type="hidden" id="baseCode" value="{{ $ShopInf->id }}">   <!-- åº—ã‚³ãƒ¼ãƒ‰ -->
                            <input type="hidden" id="eigyotype" value="1">  <!-- ç›®çš„ã‚³ãƒ¼ãƒ‰ 1:ãƒ¯ã‚«ã‚µã‚® -->
                            <input type="hidden" id="destDate">
                            <div class="modal-header" id="modal-header">
                                <label id="dateCaption" writingsuggestions="true">Great job ğŸ‰</label>
                                <span class="modalClose" onclick="modalClose()">Ã—</span>
                            </div>
                            <div class="modal-body">
                                å–¶æ¥­çŠ¶æ…‹ï¼š<select id="operating">
                                @foreach ( \App\Models\ReserveDate::GetOperating() as $item) 
                                    <option value="{{ $item[0] }}">{{ $item[1] }}</option>
                                @endforeach
                                </select>
                                <br>
                                äºˆç´„å¯èƒ½æ ï¼š<input type="number" min="1" max="20" step="1" id="capacity"><br>
                                äºˆç´„æ¸ˆäººæ•°ï¼š<input type="number" min="0" max="20" step="1" id="yoyakusu"><br>
                                ãƒ¡ãƒ¢ï¼š<textarea id="memo"> </textarea>
                                <hr>
                                <button class="mt-4" id="applysts" onclick="writeDateInfo()">é©ç”¨</button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</x-app-layout>


#spName ã¨ productName è¡¨ç¤ºã‚’
            <div class="card-header" style="text-align: center;">
                - {{ $ShopInf->spName }}ï¼š{{ $ProductInf->productName }} äºˆç´„ -
            </div>

ProductList ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã¨ã—ã€ productNameã‚’é¸æŠã™ã‚‹ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã«å¤‰æ›´
ProductIDã§é¸æŠã•ã‚Œã¦ã„ã‚‹productNameã‚’ãƒ‡ã‚£ãƒ•ã‚©ãƒ«ãƒˆé¸æŠã¨ã™ã‚‹


#ajaxã® ProductIDã‚’ ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã§é¸æŠã•ã‚Œã¦ã„ã‚‹ ProductIDã«å¤‰æ›´
$.ajax({
    url: '{{ route('reserve.calenderGet') }}', // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹URL
    type: 'GET',
    data: {
        basecode  : {{ $ShopInf->id }},
        ProductID : {{ $ProductInf->id }},
        month   : reqYM
    },                            


                   const productList = JSON.parse('


[
	{	"id":3,"baseCode":5,
		"productID":1,
		"productName":"\u30ef\u30ab\u30b5\u30ae\u5927\u30dc\u30fc\u30c8",
		"IsEnabled":1,
		"DateStart":"2025-11-01",
		"DateEnd":"2026-03-31",
		"TimeStart":"07:00:00",
		"TimeEnd":"16:00:00",
		"capacity":25,
		"WeekdayPrice":4700,
		"WeekendPrice":4700,
		"AddtionalName":"\u904a\u6f01\u5238",
		"AddtionalPrice":1000,
		"ResvTypeBit":1,
		"WaysPayBit":5,
		"memo":"\u8cb8\u7aff\u624b\u5dfb\u304d\u30ea\u30fc\u30eb\u3000\uffe51000\r\n\u8cb8\u7aff\u96fb\u52d5\u30ea\u30fc\u30eb\u3000\u3000\uffe52000\r\n\u990c(\u767d\u30b5\u30b7)\u3000\u3000\u3000\u3000\uffe5300",
		"created_at":"2025-11-04T17:50:35.000000Z",
		"updated_at":"2025-11-04T17:50:35.000000Z"
	},
	{
		"id":4,
		"baseCode":5,
		"productID":2,
		"productName":"\u30ef\u30ab\u30b5\u30ae\u5c0f\u30dc\u30fc\u30c8",
		"IsEnabled":1,
		"DateStart":"2025-11-03",
		"DateEnd":"2026-03-27",
		"TimeStart":"09:00:00",
		"TimeEnd":"15:00:00",
		"capacity":10,
		"WeekdayPrice":24000,
		"WeekendPrice":28000,
		"AddtionalName":"\u30c1\u30c3\u30d7",
		"AddtionalPrice":200,
		"ResvTypeBit":3,
		"WaysPayBit":1,
		"memo":"\u30b0\u30eb\u30fc\u30d7\u4e88\u7d04\u5c02\u7528",
		"created_at":"2025-11-07T01:47:52.000000Z",
		"updated_at":"2025-11-07T01:47:52.000000Z"
	}
]
');
VM42806:1 Uncaught SyntaxError: Bad control character in string literal in JSON at position 318 (line 1 column 319)
    at JSON.parse (<anonymous>)
    at 3:581:46


<script>
    // PHP/Laravelã§å–å¾—ã—ãŸ $product_list å¤‰æ•°ï¼ˆé…åˆ—ã¾ãŸã¯ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã‚’ç›´æ¥ä½¿ç”¨
    // @jsonãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ãŒã€è‡ªå‹•ã§å…¨ã¦ã®ç‰¹æ®Šæ–‡å­—ï¼ˆæ”¹è¡Œã‚’å«ã‚€ï¼‰ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã—ã¾ã™ã€‚
    const productList = @json($product_list);

    // ã“ã‚Œã§ productList ã¯JavaScriptã®é…åˆ—ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦æ‰±ãˆã¾ã™
    // ä¾‹: console.log(productList[0].memo);
</script>

